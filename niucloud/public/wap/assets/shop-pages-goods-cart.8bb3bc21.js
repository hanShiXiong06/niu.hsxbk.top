import{d as e,J as t,c as a,r as l,b as s,$ as r,i as o,P as c,j as n,w as u,n as i,k as x,R as p,G as f,H as d,Q as m,m as _,D as g,N as h,_ as v,e as k,q as b,t as y,x as w,I as j,a7 as C,aH as S,y as z}from"./index-19cdd642.js";import{_ as E}from"./u-button.16c348c3.js";import{_ as F}from"./u-empty.946c9418.js";import{_ as V}from"./u-icon.608fbfc2.js";import{_ as D}from"./u--image.925f4ba8.js";import{u as I,g as q,_ as B}from"./cart.42f51b36.js";import{_ as H,a as L}from"./uni-swipe-action.384733b7.js";import{_ as U}from"./u-loading-page.1349466f.js";import{_ as $}from"./tabbar.b665b011.js";import{_ as A}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-loading-icon.448cb1c8.js";import"./u-image.28b481c5.js";import"./u-transition.862f512b.js";import"./u-badge.23b944d1.js";import"./u-tabbar.41e257d5.js";import"./u-safe-bottom.c40e3bad.js";const G=A(e({__name:"cart",setup(e){const A=t(),G=a((()=>A.info)),J=l(!0),K=l(!1),N=l("0.00"),P=l([]),Q=l([]),R=l(!1),W=I(),M=()=>{q({}).then((({data:e})=>{P.value=[],Q.value=[],e.forEach((e=>{e.checked=!1,e.status&&0==e.goods.delete_time?P.value.push(e):Q.value.push(e)})),J.value=!1})).catch()};s((()=>{G.value?(M(),W.getList()):J.value=!1})),r((()=>G.value),(()=>{G.value&&M()}));const O=a((()=>{let e=0;return P.value.forEach((t=>{t.checked&&(e+=1)})),e}));r((()=>P.value),(()=>{let e=0;P.value.forEach((t=>{t.checked&&(e+=parseFloat(t.goodsSku.sale_price)*t.num)})),N.value=e.toFixed(2)}),{deep:!0});const T=()=>{h().setLoginBack({url:"/shop/pages/goods/cart"})},X=e=>({min:1,max:e.goodsSku.stock||1});l([{text:"删除",style:{backgroundColor:"#F56C6C"}}]);const Y=(e,t)=>{if(K.value)return;K.value=!0;const a=P.value[e];W.delete(a.id,(()=>{"cart"==t?P.value.splice(e,1):Q.value.splice(e,1),K.value=!1}))},Z=()=>{const e=P.value.length!=O.value;P.value.forEach((t=>{t.checked=e}))},ee=()=>{if(!O.value)return void v({title:"还没有选择商品",icon:"none"});const e=[];P.value.forEach((t=>{t.checked&&e.push(t.id)})),uni.setStorage({key:"orderCreateData",data:{cart_ids:e},success(){k({url:"/shop/pages/order/payment"})}})},te=()=>{if(!O.value)return void v({title:"还没有选择商品",icon:"none"});if(K.value)return;K.value=!0;const e=[];P.value.forEach((t=>{t.checked&&e.push(t.id)})),W.delete(e,(()=>{M(),K.value=!1}))};return(e,t)=>{const a=b(y("u-button"),E),l=b(y("u-empty"),F),s=w,r=j,h=b(y("u-icon"),V),v=b(y("u--image"),D),I=b(y("u-number-box"),B),q=b(y("uni-swipe-action-item"),H),A=b(y("uni-swipe-action"),L),M=C,ae=S,le=b(y("u-loading-page"),U),se=b(y("tabbar"),$);return o(),c(p,null,[J.value?_("v-if",!0):(o(),n(s,{key:0,class:"bg-page h-screen overflow-hidden flex flex-col"},{default:u((()=>[i(G)?P.value.length?(o(),c(p,{key:2},[x(s,{class:"flex justify-between px-[32rpx] leading-[84rpx] font-500 text-[#666] text-[26rpx] bg-[#fff]"},{default:u((()=>[x(r,null,{default:u((()=>[f("共"+d(P.value.length)+"件宝贝",1)])),_:1}),x(r,{onClick:t[1]||(t[1]=e=>R.value=!R.value)},{default:u((()=>[f(d(R.value?"完成":"编辑"),1)])),_:1})])),_:1}),x(s,{class:"flex-1 h-0"},{default:u((()=>[x(M,{class:"scroll-height box-border","scroll-y":!0},{default:u((()=>[x(s,{class:"py-[20rpx] px-[24rpx]"},{default:u((()=>[x(A,null,{default:u((()=>[(o(!0),c(p,null,m(P.value,((e,t)=>(o(),n(s,{class:g(["bg-[#fff] py-[30rpx] rounded-[18rpx] overflow-hidden",t?"mt-[20rpx]":""])},{default:u((()=>[x(q,null,{right:u((()=>[x(s,{class:"w-[80rpx] h-[100%] flex items-center justify-center bg-[var(--primary-color)] text-[#fff] text-[28rpx]",onClick:e=>Y(t,"cart")},{default:u((()=>[x(r,null,{default:u((()=>[f("删除")])),_:1})])),_:2},1032,["onClick"])])),default:u((()=>[x(s,{class:g(["flex px-[24rpx]"])},{default:u((()=>[x(r,{class:g(["self-center iconfont text-color text-[37rpx] mr-[24rpx]",e.checked?"iconxuanze1":"iconcheckbox_nol"]),onClick:t=>e.checked=!e.checked},null,8,["class","onClick"]),x(v,{width:"168rpx",height:"168rpx",src:i(z)(e.goodsSku.sku_image_thumb_mid),model:"aspectFill"},{error:u((()=>[x(h,{name:"photo",color:"#999",size:"50"})])),_:2},1032,["src"]),x(s,{class:"flex flex-1 flex-wrap ml-[20rpx]"},{default:u((()=>[x(s,{class:"w-[100%]"},{default:u((()=>[x(s,{class:"w-[404rpx] multi-hidden text-[#333] text-[26rpx] leading-[36rpx]"},{default:u((()=>[f(d(e.goods.goods_name),1)])),_:2},1024),x(s,{class:"w-[404rpx] mt-[12rpx] truncate text-[#888] text-[24rpx] leading-[32rpx] font-500"},{default:u((()=>[f(d(e.goodsSku.sku_spec_format),1)])),_:2},1024)])),_:2},1024),x(s,{class:"flex justify-between items-end self-end w-[100%]"},{default:u((()=>[x(s,{class:"text-[var(--price-text-color)] leading-[40rpx] price-font"},{default:u((()=>[x(r,{class:"text-[24rpx] font-500"},{default:u((()=>[f("￥")])),_:1}),x(r,{class:"text-[32rpx] mr-[10rpx] font-500"},{default:u((()=>[f(d(e.goodsSku.sale_price),1)])),_:2},1024)])),_:2},1024),x(I,{modelValue:e.num,"onUpdate:modelValue":t=>e.num=t,min:X(e).min,max:X(e).max,integer:"",step:1,"input-width":"68rpx","input-height":"52rpx","button-size":"52rpx",disabledInput:"",onChange:e=>((e,t)=>{uni.$u.debounce((e=>{const a=P.value[t];W.increase({id:a.id,goods_id:a.goods_id,sku_id:a.sku_id,stock:a.goodsSku.stock,sale_price:a.goodsSku.sale_price,num:a.num},0)}),500)})(0,t)},{minus:u((()=>[x(r,{class:g([{"text-[#c8c9cc]":e.num===X(e).min,"text-[var(--primary-color)]":e.num!==X(e).min},"text-[44rpx] iconfont iconjianhao"])},null,8,["class"])])),input:u((()=>[x(r,{class:"text-[#333] fext-[23rpx] font-500 mx-[16rpx]"},{default:u((()=>[f(d(e.num),1)])),_:2},1024)])),plus:u((()=>[x(r,{class:g([{"text-[#c8c9cc]":e.num===X(e).max," text-[var(--primary-color)]":e.num!==X(e).max},"text-[44rpx] text-[var(--primary-color)] iconfont iconjiahao2fill"])},null,8,["class"])])),_:2},1032,["modelValue","onUpdate:modelValue","min","max","onChange"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])))),256)),(o(!0),c(p,null,m(Q.value,((e,t)=>(o(),n(s,{class:g(["bg-[#fff] py-[30rpx] rounded-[18rpx] overflow-hidden mt-[20rpx]"])},{default:u((()=>[x(q,null,{right:u((()=>[x(s,{class:"w-[80rpx] h-[100%] flex items-center justify-center bg-[var(--primary-color)] text-[#fff] text-[28rpx]",onClick:e=>Y(t,"invalid")},{default:u((()=>[x(r,null,{default:u((()=>[f("删除")])),_:1})])),_:2},1032,["onClick"])])),default:u((()=>[x(s,{class:g(["flex px-[24rpx]"])},{default:u((()=>[x(r,{class:"self-center iconfont text-[37rpx] mr-[24rpx] iconcheckbox_nol bg-[#f5f5f5] text-[#eee] rounded-[50%]"}),x(s,{class:"relative w-[168rpx] h-[168rpx]"},{default:u((()=>[x(v,{width:"168rpx",height:"168rpx",src:i(z)(e.goodsSku.sku_image_thumb_mid),model:"aspectFill"},{error:u((()=>[x(h,{name:"photo",color:"#999",size:"50"})])),_:2},1032,["src"]),x(s,{class:"absolute left-0 top-0 w-[168rpx] h-[168rpx] leading-[168rpx] text-center",style:{"background-color":"rgba(243,244,246,0.5)"}},{default:u((()=>[x(r,{class:"text-[#333] text-[24rpx] font-500"},{default:u((()=>[f("已失效")])),_:1})])),_:1})])),_:2},1024),x(s,{class:"flex flex-1 flex-wrap ml-[20rpx]"},{default:u((()=>[x(s,{class:"w-[100%]"},{default:u((()=>[x(s,{class:"w-[404rpx] multi-hidden text-[#333] text-[26rpx] leading-[36rpx]"},{default:u((()=>[f(d(e.goods.goods_name),1)])),_:2},1024),x(s,{class:"w-[404rpx] mt-[12rpx] truncate text-[#888] text-[24rpx] leading-[32rpx] font-500"},{default:u((()=>[f(d(e.goodsSku.sku_spec_format),1)])),_:2},1024)])),_:2},1024),x(s,{class:"flex justify-between items-end self-end w-[100%]"},{default:u((()=>[x(s,{class:"text-[var(--price-text-color)] leading-[40rpx] price-font"},{default:u((()=>[x(r,{class:"text-[24rpx] font-500"},{default:u((()=>[f("￥")])),_:1}),x(r,{class:"text-[32rpx] mr-[10rpx] font-500"},{default:u((()=>[f(d(e.goodsSku.sale_price),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),256))])),_:1})])),_:1})])),_:1})])),_:1})],64)):(o(),n(s,{key:1,class:"flex-1 flex flex-col justify-center"},{default:u((()=>[x(l,{mode:"car"}),x(a,{text:"去逛逛",type:"primary",shape:"circle",size:"normal",class:"!w-[200rpx] mt-[20rpx]",onClick:t[0]||(t[0]=e=>i(k)({url:"/shop/pages/goods/list"}))})])),_:1})):(o(),n(s,{key:0,class:"flex-1 flex flex-col justify-center"},{default:u((()=>[x(l,{mode:"data",text:"未登录"},{default:u((()=>[x(a,{text:"去登录",type:"primary",shape:"circle",size:"normal",class:"!w-[200rpx] mt-[20rpx]",onClick:T})])),_:1})])),_:1}))])),_:1})),P.value.length?(o(),n(s,{key:1,class:"flex h-[100rpx] items-center bg-[#fff] fixed left-0 right-0 bottom-[50px] box-solid mb-[env(safe-area-inset-bottom)]"},{default:u((()=>[x(s,{class:"flex items-center px-[30rpx]",onClick:Z},{default:u((()=>[x(r,{class:g(["iconfont text-color text-[34rpx] mr-[12rpx]",P.value.length==i(O)?"iconxuanze1":"iconcheckbox_nol"])},null,8,["class"]),x(r,{class:"font-500 text-[#676767] text-[25rpx]"},{default:u((()=>[f("全选")])),_:1})])),_:1}),R.value?(o(),n(s,{key:1,class:"flex-1 flex items-center justify-end"},{default:u((()=>[x(ae,{class:"!w-[204rpx] !h-[80rpx] text-[#fff] text-[30rpx] !leading-[80rpx] !text-[32rpx] mr-[30rpx] bg-color",shape:"circle",onClick:te},{default:u((()=>[f("删除")])),_:1})])),_:1})):(o(),n(s,{key:0,class:"flex-1 flex items-center justify-between"},{default:u((()=>[x(r,{class:"whitespace-nowrap mr-[24rpx] text-[var(--price-text-color)] font-500 leading-[45rpx]"},{default:u((()=>[x(r,{class:"text-[#333333] text-[32rpx]"},{default:u((()=>[f("合计：")])),_:1}),x(r,{class:"text-[24rpx] price-font"},{default:u((()=>[f("￥")])),_:1}),x(r,{class:"text-[34rpx] mr-[10rpx] price-font"},{default:u((()=>[f(d(N.value),1)])),_:1})])),_:1}),x(ae,{class:"!w-[204rpx] !h-[80rpx] text-[#fff] text-[30rpx] !leading-[80rpx] !text-[32rpx] mr-[30rpx] bg-color",shape:"circle",onClick:ee},{default:u((()=>[f("结算")])),_:1})])),_:1}))])),_:1})):_("v-if",!0),x(le,{loading:K.value,"loading-text":"","bg-color":"none",loadingColor:"var(--primary-color)",iconSize:"35"},null,8,["loading"]),x(le,{loading:J.value,"loading-text":"","bg-color":"#f7f7f7",loadingColor:"var(--primary-color)",iconSize:"35"},null,8,["loading"]),x(se)],64)}}}),[["__scopeId","data-v-6d69b04c"]]);export{G as default};
