import{u as e,_ as a,a as l}from"./u-form.4859819c.js";import{d as t,r as i,a as r,at as s,$ as d,au as o,q as c,t as u,i as n,j as p,w as m,k as v,G as f,D as _,H as y,m as b,l as h,P as x,R as g,Q as k,v as V,x as j,a7 as C,o as P,av as w,c as $,n as q,aw as A,ax as U,e as E,K as R}from"./index-98826dc8.js";import{_ as D}from"./u-switch.34b75d65.js";import{_ as I}from"./u-button.3ca081fb.js";import{_ as Q}from"./u-popup.5ab022a0.js";import"./u-icon.f3535e52.js";import"./_plugin-vue_export-helper.1b428a4d.js";import"./u-line.04b866e6.js";import"./u-loading-icon.9963a5a3.js";import"./u-transition.b9a2700d.js";import"./u-safe-bottom.35e4ae97.js";const T=t({__name:"area-select",props:{areaId:{type:Number,default:0}},emits:["complete"],setup(e,{expose:a,emit:l}){const t=e,P=i(!1),w=r({province:[],city:[],district:[]}),$=i("province"),q=r({province:null,city:null,district:null});s(0).then((({data:e})=>{w.province=e})).catch(),d((()=>t.areaId),((e,a)=>{e&&!a&&o(e).then((({data:e})=>{e.province&&(q.province=e.province),e.city&&(q.city=e.city),e.district&&(q.district=e.district)})).catch()})),d((()=>q.province),(()=>{s(q.province.id).then((({data:e})=>{if(w.city=e,$.value="city",q.city){let a=!1;for(let l=0;l<e.length;l++)if(q.city.id==e[l].id){a=!0;break}a||(q.city=null)}})).catch()}),{deep:!0}),d((()=>q.city),(e=>{e?s(q.city.id).then((({data:e})=>{if(w.district=e,$.value="district",q.district){let a=!1;for(let l=0;l<e.length;l++)if(q.district.id==e[l].id){a=!0;break}a||(q.district=null)}})).catch():(w.district=[],q.district=null)}),{deep:!0}),d((()=>q.district),(e=>{e&&($.value="district",l("complete",q),P.value=!1)}),{deep:!0});return a({open:()=>{P.value=!0}}),(e,a)=>{const l=j,t=C,i=c(u("u-popup"),Q);return n(),p(i,{show:P.value,onClose:a[3]||(a[3]=e=>P.value=!1),mode:"bottom",round:10,closeable:!0},{default:m((()=>[v(l,{class:"text-center p-[30rpx]"},{default:m((()=>[f("请选择地区")])),_:1}),v(l,{class:"flex p-[30rpx] text-sm font-semibold"},{default:m((()=>[w.province.length?(n(),p(l,{key:0,class:_(["pr-[50rpx]",{"text-[red]":"province"==$.value}]),onClick:a[0]||(a[0]=e=>$.value="province")},{default:m((()=>[q.province?(n(),p(l,{key:0},{default:m((()=>[f(y(q.province.name),1)])),_:1})):(n(),p(l,{key:1},{default:m((()=>[f("请选择")])),_:1}))])),_:1},8,["class"])):b("v-if",!0),w.city.length?(n(),p(l,{key:1,class:_(["pr-[50rpx]",{"text-[red]":"city"==$.value}]),onClick:a[1]||(a[1]=e=>$.value="city")},{default:m((()=>[q.city?(n(),p(l,{key:0},{default:m((()=>[f(y(q.city.name),1)])),_:1})):(n(),p(l,{key:1},{default:m((()=>[f("请选择")])),_:1}))])),_:1},8,["class"])):b("v-if",!0),w.district.length?(n(),p(l,{key:2,class:_(["pr-[50rpx]",{"text-[red]":"district"==$.value}]),onClick:a[2]||(a[2]=e=>$.value="district")},{default:m((()=>[q.district?(n(),p(l,{key:0},{default:m((()=>[f(y(q.district.name),1)])),_:1})):(n(),p(l,{key:1},{default:m((()=>[f("请选择")])),_:1}))])),_:1},8,["class"])):b("v-if",!0)])),_:1}),v(t,{"scroll-y":"true",class:"h-[50vh]"},{default:m((()=>[v(l,{class:"flex p-[30rpx] pt-0 text-sm"},{default:m((()=>[w.province.length?h((n(),p(l,{key:0},{default:m((()=>[(n(!0),x(g,null,k(w.province,(e=>(n(),p(l,{class:_(["leading-loose",{"text-[red]":q.province&&q.province.id==e.id}]),onClick:a=>q.province=e},{default:m((()=>[f(y(e.name),1)])),_:2},1032,["class","onClick"])))),256))])),_:1},512)),[[V,"province"==$.value]]):b("v-if",!0),w.city.length?h((n(),p(l,{key:1},{default:m((()=>[(n(!0),x(g,null,k(w.city,(e=>(n(),p(l,{class:_(["leading-loose",{"text-[red]":q.city&&q.city.id==e.id}]),onClick:a=>q.city=e},{default:m((()=>[f(y(e.name),1)])),_:2},1032,["class","onClick"])))),256))])),_:1},512)),[[V,"city"==$.value]]):b("v-if",!0),w.district.length?h((n(),p(l,{key:2},{default:m((()=>[(n(!0),x(g,null,k(w.district,(e=>(n(),p(l,{class:_(["leading-loose",{"text-[red]":q.district&&q.district.id==e.id}]),onClick:a=>q.district=e},{default:m((()=>[f(y(e.name),1)])),_:2},1032,["class","onClick"])))),256))])),_:1},512)),[[V,"district"==$.value]]):b("v-if",!0)])),_:1})])),_:1})])),_:1},8,["show"])}}}),z=t({__name:"address_edit",setup(t){const r=i({id:0,name:"",mobile:"",province_id:0,city_id:0,district_id:0,address:"",full_address:"",is_default:0,area:"",type:"address"}),s=i(),d=i(null),o=i("");P((e=>{e.id&&w(e.id).then((({data:e})=>{e&&Object.assign(r.value,e)})).catch(),o.value=e.type||""}));const _=$((()=>({name:{type:"string",required:!0,message:R("namePlaceholder"),trigger:["blur","change"]},mobile:[{type:"string",required:!0,message:R("mobilePlaceholder"),trigger:["blur","change"]},{validator:()=>uni.$u.test.mobile(r.value.mobile),message:R("mobileError")}],area:{validator:()=>!uni.$u.test.isEmpty(r.value.area),message:R("selectAreaPlaceholder")},address:{type:"string",required:!0,message:R("addressPlaceholder"),trigger:["blur","change"]}}))),b=()=>{s.value.open()},h=e=>{r.value.province_id=e.province.id||0,r.value.city_id=e.city.id||0,r.value.district_id=e.district.id||0,r.value.area=`${e.province.name||""}${e.city.name||""}${e.district.name||""}`},k=i(!1),V=()=>{const e=r.value.id?A:U;d.value.validate().then((()=>{k.value||(k.value=!0,r.value.full_address=r.value.area+r.value.address,e(r.value).then((e=>{k.value=!1,setTimeout((()=>{E({url:"/app/pages/member/address",param:{type:o.value}})}),1e3)})).catch((()=>{k.value=!1})))}))};return(t,i)=>{const o=c(u("u-input"),e),C=c(u("u-form-item"),a),P=j,w=c(u("u-switch"),D),$=c(u("u-button"),I),A=c(u("u-form"),l),U=c(u("area-select"),T);return n(),x(g,null,[v(P,{class:"px-[30rpx]"},{default:m((()=>[v(A,{labelPosition:"left",model:r.value,labelWidth:"200rpx",errorType:"toast",rules:q(_),ref_key:"formRef",ref:d},{default:m((()=>[v(P,{class:"mt-[10rpx]"},{default:m((()=>[v(C,{label:q(R)("name"),prop:"name","border-bottom":!0},{default:m((()=>[v(o,{modelValue:r.value.name,"onUpdate:modelValue":i[0]||(i[0]=e=>r.value.name=e),border:"none",clearable:"",placeholder:q(R)("namePlaceholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1}),v(P,{class:"mt-[10rpx]"},{default:m((()=>[v(C,{label:q(R)("mobile"),prop:"mobile","border-bottom":!0},{default:m((()=>[v(o,{modelValue:r.value.mobile,"onUpdate:modelValue":i[1]||(i[1]=e=>r.value.mobile=e),border:"none",clearable:"",placeholder:q(R)("mobilePlaceholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1}),v(P,{class:"mt-[10rpx]"},{default:m((()=>[v(C,{label:q(R)("selectArea"),prop:"area","border-bottom":!0,onClick:b},{default:m((()=>[r.value.area?(n(),p(P,{key:1,class:"text-[30rpx]"},{default:m((()=>[f(y(r.value.area),1)])),_:1})):(n(),p(P,{key:0,class:"text-gray-placeholder text-[30rpx]"},{default:m((()=>[f(y(q(R)("selectAreaPlaceholder")),1)])),_:1}))])),_:1},8,["label"])])),_:1}),v(P,{class:"mt-[10rpx]"},{default:m((()=>[v(C,{label:q(R)("address"),prop:"address","border-bottom":!0},{default:m((()=>[v(o,{modelValue:r.value.address,"onUpdate:modelValue":i[2]||(i[2]=e=>r.value.address=e),border:"none",clearable:"",placeholder:q(R)("addressPlaceholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1}),v(P,{class:"mt-[10rpx]"},{default:m((()=>[v(C,{label:q(R)("defaultAddress"),prop:"name","border-bottom":!0},{default:m((()=>[v(w,{modelValue:r.value.is_default,"onUpdate:modelValue":i[3]||(i[3]=e=>r.value.is_default=e),size:"20",activeValue:1,inactiveValue:0},null,8,["modelValue"])])),_:1},8,["label"])])),_:1}),v(P,{class:"mt-[40rpx]"},{default:m((()=>[v($,{type:"primary",shape:"circle",text:q(R)("save"),onClick:V,loading:k.value},null,8,["text","loading"])])),_:1})])),_:1},8,["model","rules"])])),_:1}),v(U,{ref_key:"areaRef",ref:s,onComplete:h,"area-id":r.value.district_id},null,8,["area-id"])],64)}}});export{z as default};
