/* empty css             *//* empty css                   */import{E as te}from"./el-overlay-380df695.js";/* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  */import"./index-1bbcede8.js";/* empty css                  *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css                        */import{a as ae,E as le}from"./el-form-item-144bc604.js";/* empty css                          *//* empty css                 *//* empty css                  */import{v as G}from"./event-3e082a4a.js";import{_ as L}from"./goods_default-3802d665.js";import{t as s}from"./index-3862e13d.js";import{c as se}from"./common-a45d855f.js";import{g as re,a as pe,b as de}from"./goods-fd566118.js";import{c as ie}from"./cloneDeep-028669bf.js";import{a as N}from"./index-a6ffcea0.js";import{E as ne}from"./index-6f670765.js";import{a as me,E as ce}from"./index-b7b91fcb.js";import{E as ge}from"./index-5f2625ed.js";import{E as ue}from"./index-22ce9a15.js";import{a as _e,E as fe}from"./index-6191b0b4.js";import{E as he}from"./index-6701860e.js";import{E as ye}from"./index-cefc0b67.js";import{v as ve}from"./directive-d226d53f.js";import{d as Se,c as B,r as C,M as E,b as S,e as T,f as d,g as Pe,q as r,p,v as P,x as m,u as o,L as V,F as xe,t as be,m as $,A as ke,at as Ce,au as Ee}from"./runtime-core.esm-bundler-c17ab5bc.js";import{_ as Ve}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-93efb1b5.js";import"./index-9ef6974e.js";import"./plugin-vue_export-helper-c018272e.js";import"./focus-trap-c0148071.js";import"./index-4b62c73a.js";import"./index-332680c2.js";import"./vue-router-9f815af7.js";import"./index-0d36ccbf.js";import"./el-main-03d12282.js";import"./index-e42600b8.js";import"./index-138bfa06.js";import"./index-72bf6cb5.js";import"./_baseClone-37ba2e68.js";import"./index-5c20ff8f.js";import"./strings-e72e60f7.js";import"./isEqual-ca98cf0c.js";import"./debounce-196ce6a6.js";import"./index-bfecf17f.js";import"./validator-f5e079db.js";import"./index-784d7581.js";import"./index-6ff31475.js";import"./rand-14326ce1.js";import"./aria-adfa05c5.js";import"./arrays-e667dc24.js";import"./_isIterateeCall-797defa1.js";import"./index-f6eed9e8.js";import"./position-0d02b322.js";const we=x=>(Ce("data-v-aafa4f90"),x=x(),Ee(),x),Ge={class:"inline-block ml-[10px] text-[14px]"},Te={class:"text-primary mx-[2px]"},$e={class:"flex items-center cursor-pointer"},De={class:"min-w-[60px] h-[60px] flex items-center justify-center"},Ie=we(()=>d("div",{class:"image-slot"},[d("img",{class:"w-[60px] h-[60px]",src:L})],-1)),Fe={key:1,class:"w-[70px] h-[60px]",src:L,fit:"contain"},Ne={class:"ml-2"},Be=["title"],Le={class:"text-primary text-[12px]"},Ue={class:"mt-[16px] flex"},ze={class:"flex items-center flex-1"},Re={class:"layui-table-bottom-left-container mr-[10px]"},Ae={class:"text-primary mx-[2px]"},Me={class:"dialog-footer"},Oe=Se({__name:"goods-select-popup",props:{modelValue:{type:String,default:""},max:{type:Number,default:0},min:{type:Number,default:0}},emits:["update:modelValue"],setup(x,{expose:U,emit:z}){const u=x,g=B({get(){return u.modelValue},set(a){z("update:modelValue",a)}}),y=C(!1),c=E({}),f=B(()=>Object.keys(c).length);let t=E({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{keyword:"",goods_category:[],select_type:"all",goods_ids:"",verify_goods_ids:"",goods_type:""}});const D=C(),R=a=>{v()},w=E([]),A={checkStrictly:!0},I=E([]);(()=>{re().then(a=>{let e=a.data;if(e){let i=[];e.forEach(n=>{let h=[];n.child_list&&n.child_list.forEach(_=>{h.push({value:_.category_id,label:_.category_name})}),i.push({value:n.category_id,label:n.category_name,children:h})}),w.splice(0,w.length,...i)}}),pe().then(a=>{let e=a.data;if(e)for(let i in e)I.push(e[i])})})();const b=C();C([]);const M=(a,e)=>{let i=!1;for(let n=0;n<a.length;n++)if(a[n].goods_id==e.goods_id){i=!0;break}i?c["goods_"+e.goods_id]=e:delete c["goods_"+e.goods_id]},O=a=>{a.length?a.forEach(e=>{c["goods_"+e.goods_id]=e}):t.data.forEach(e=>{delete c["goods_"+e.goods_id]})},v=(a=1,e=null)=>{t.loading=!0,t.page=a;let i=ie(t.searchParam);if(i.select_type=="selected"){let n=[];for(let h in c)n.push(parseInt(h.replace("goods_","")));i.goods_ids=n}else i.goods_ids="";de({page:t.page,limit:t.limit,...i}).then(n=>{t.loading=!1,t.data=n.data.data,t.total=n.data.total,e&&e(n.data.verify_goods_ids),F()}).catch(()=>{t.loading=!1})},F=()=>{ke(()=>{if(b.value)for(let a=0;a<t.data.length;a++)b.value.toggleRowSelection(t.data[a],!1),c["goods_"+t.data[a].goods_id]&&b.value.toggleRowSelection(t.data[a],!0)})},j=a=>{a&&(a.resetFields(),v())},q=()=>{t.searchParam.verify_goods_ids=g.value,v(1,a=>{if(g.value){g.value.splice(0,g.value.length,...a),g.value.forEach(e=>{c["goods_"+e]||(c["goods_"+e]={})});for(let e=0;e<t.data.length;e++)g.value.indexOf(t.data[e].goods_id)!=-1&&(c["goods_"+t.data[e].goods_id]=t.data[e])}}),y.value=!0},H=()=>{for(let a in c)delete c[a];F()},J=()=>{if(u.min&&f.value<u.min){N({type:"warning",message:`${s("goodsSelectPopupGoodsMinTip")}${u.min}${s("goodsSelectPopupPiece")}`});return}if(u.max&&u.max>0&&f.value&&f.value>u.max){N({type:"warning",message:`${s("goodsSelectPopupGoodsMaxTip")}${u.max}${s("goodsSelectPopupPiece")}`});return}let a=[];for(let e in c)a.push(parseInt(e.replace("goods_","")));g.value.splice(0,g.value.length,...a),y.value=!1};return U({showDialog:y,selectGoods:c,selectGoodsNum:f}),(a,e)=>{const i=ne,n=me,h=ce,_=ae,K=ge,Q=ue,W=le,k=_e,X=he,Y=fe,Z=ye,ee=te,oe=ve;return S(),T("div",null,[d("div",{onClick:q},[Pe(a.$slots,"default",{},()=>[r(i,null,{default:p(()=>[P(m(o(s)("goodsSelectPopupSelectGoodsButton")),1)]),_:1}),V(d("div",Ge,[d("span",null,m(o(s)("goodsSelectPopupSelect")),1),d("span",Te,m(o(g).length),1),d("span",null,m(o(s)("goodsSelectPopupPiece")),1)],512),[[G,o(g).length]])],!0)]),r(ee,{modelValue:y.value,"onUpdate:modelValue":e[10]||(e[10]=l=>y.value=l),title:o(s)("goodsSelectPopupSelectGoodsDialog"),width:"1000px","close-on-press-escape":!1,"destroy-on-close":!0,"close-on-click-modal":!1},{footer:p(()=>[d("span",Me,[r(i,{onClick:e[9]||(e[9]=l=>y.value=!1)},{default:p(()=>[P(m(o(s)("cancel")),1)]),_:1}),r(i,{type:"primary",onClick:J},{default:p(()=>[P(m(o(s)("confirm")),1)]),_:1})])]),default:p(()=>[r(W,{inline:!0,model:o(t).searchParam,ref_key:"searchFormRef",ref:D},{default:p(()=>[r(_,{prop:"select_type",class:"form-item-wrap"},{default:p(()=>[r(h,{modelValue:o(t).searchParam.select_type,"onUpdate:modelValue":e[0]||(e[0]=l=>o(t).searchParam.select_type=l),onChange:R},{default:p(()=>[r(n,{label:o(s)("goodsSelectPopupAllGoods"),value:"all"},null,8,["label"]),r(n,{label:o(s)("goodsSelectPopupSelectedGoods"),value:"selected"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1}),r(_,{label:o(s)("goodsSelectPopupGoodsName"),prop:"keyword",class:"form-item-wrap"},{default:p(()=>[r(K,{modelValue:o(t).searchParam.keyword,"onUpdate:modelValue":e[1]||(e[1]=l=>o(t).searchParam.keyword=l),placeholder:o(s)("goodsSelectPopupGoodsNamePlaceholder"),maxlength:"60"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(_,{label:o(s)("goodsSelectPopupGoodsCategory"),prop:"goods_category",class:"form-item-wrap"},{default:p(()=>[r(Q,{props:A,modelValue:o(t).searchParam.goods_category,"onUpdate:modelValue":e[2]||(e[2]=l=>o(t).searchParam.goods_category=l),options:w,placeholder:o(s)("goodsSelectPopupGoodsCategoryPlaceholder"),clearable:"",filterable:"",onChange:a.categoryHandleChange},null,8,["modelValue","options","placeholder","onChange"])]),_:1},8,["label"]),r(_,{label:o(s)("goodsSelectPopupGoodsType"),prop:"goods_type",class:"form-item-wrap"},{default:p(()=>[r(h,{modelValue:o(t).searchParam.goods_type,"onUpdate:modelValue":e[3]||(e[3]=l=>o(t).searchParam.goods_type=l),placeholder:o(s)("goodsSelectPopupGoodsTypePlaceholder"),clearable:""},{default:p(()=>[(S(!0),T(xe,null,be(I,l=>(S(),$(n,{key:l.type,label:l.name,value:l.type},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),r(_,{class:"form-item-wrap"},{default:p(()=>[r(i,{type:"primary",onClick:e[4]||(e[4]=l=>v())},{default:p(()=>[P(m(o(s)("search")),1)]),_:1}),r(i,{onClick:e[5]||(e[5]=l=>j(D.value))},{default:p(()=>[P(m(o(s)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"]),V((S(),$(Y,{data:o(t).data,size:"large",ref_key:"goodsListTableRef",ref:b,"max-height":"400",onSelect:M,onSelectAll:O},{empty:p(()=>[d("span",null,m(o(t).loading?"":o(s)("emptyData")),1)]),default:p(()=>[r(k,{type:"selection",width:"55"}),r(k,{prop:"goods_id",label:o(s)("goodsSelectPopupGoodsInfo"),"min-width":"400"},{default:p(({row:l})=>[d("div",$e,[d("div",De,[l.goods_cover_thumb_small?(S(),$(X,{key:0,class:"w-[60px] h-[60px]",src:o(se)(l.goods_cover_thumb_small),fit:"contain"},{error:p(()=>[Ie]),_:2},1032,["src"])):(S(),T("img",Fe))]),d("div",Ne,[d("span",{title:l.goods_name,class:"multi-hidden"},m(l.goods_name),9,Be),d("span",Le,m(l.goods_type_name),1)])])]),_:1},8,["label"]),r(k,{prop:"price",label:o(s)("goodsSelectPopupPrice"),"min-width":"120",align:"right"},{default:p(({row:l})=>[d("div",null,"ï¿¥"+m(l.goodsSku.price),1)]),_:1},8,["label"]),r(k,{prop:"stock",label:o(s)("goodsSelectPopupStock"),"min-width":"120",align:"right"},null,8,["label"])]),_:1},8,["data"])),[[oe,o(t).loading]]),d("div",Ue,[d("div",ze,[V(d("div",Re,[d("span",null,m(o(s)("goodsSelectPopupBeforeTip")),1),d("span",Ae,m(o(f)),1),d("span",null,m(o(s)("goodsSelectPopupAfterTip")),1)],512),[[G,o(f)]]),V(r(i,{type:"primary",link:"",onClick:H},{default:p(()=>[P(m(o(s)("goodsSelectPopupClearGoods")),1)]),_:1},512),[[G,o(f)]])]),r(Z,{"current-page":o(t).page,"onUpdate:currentPage":e[6]||(e[6]=l=>o(t).page=l),"page-size":o(t).limit,"onUpdate:pageSize":e[7]||(e[7]=l=>o(t).limit=l),layout:"total, sizes, prev, pager, next, jumper",total:o(t).total,onSizeChange:e[8]||(e[8]=l=>v()),onCurrentChange:v},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue","title"])])}}});const ot=Ve(Oe,[["__scopeId","data-v-aafa4f90"]]);export{ot as default};
