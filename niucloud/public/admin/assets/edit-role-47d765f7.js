/* empty css             *//* empty css                   */import{E as K}from"./el-overlay-380df695.js";import{a as L,E as J}from"./el-form-item-144bc604.js";import{G as z,H as Q,I as W,J as X}from"./index-596de8a9.js";/* empty css                *//* empty css                    *//* empty css                  *//* empty css                       *//* empty css                 *//* empty css                 */import{t}from"./index-6b4cbbe4.js";import{e as Y}from"./common-a45d855f.js";import{E as Z}from"./index-5f2625ed.js";import{E as ee,b as le}from"./index-6ff31475.js";import{E as oe}from"./index-784d7581.js";import{E as te}from"./index-6f670765.js";import{E as ae}from"./index-0ee88e31.js";import{E as re}from"./index-72bf6cb5.js";import{v as se}from"./directive-d226d53f.js";import{d as ne,r as d,w as ie,ac as ue,M as me,c as ce,b as D,m as N,p as i,f as w,q as r,v as h,x as b,u as s,L as de}from"./runtime-core.esm-bundler-c17ab5bc.js";import"./event-3e082a4a.js";import"./plugin-vue_export-helper-c018272e.js";import"./index-9ef6974e.js";import"./index-93efb1b5.js";import"./focus-trap-c0148071.js";import"./index-4b62c73a.js";import"./index-332680c2.js";import"./_baseClone-37ba2e68.js";import"./vue-router-9f815af7.js";import"./index-0d36ccbf.js";import"./el-main-03d12282.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./index-e42600b8.js";/* empty css                  */import"./index-a6ffcea0.js";import"./index-138bfa06.js";import"./isEqual-ca98cf0c.js";import"./index-0b4c4f48.js";const pe={class:"flex items-center justify-between w-11/12"},fe={class:"dialog-footer"},ll=ne({__name:"edit-role",emits:["complete"],setup(_e,{expose:O,emit:U}){const _=d(!1),c=d(!1),g=d(!0);let k="";const f=d([]);z().then(l=>{f.value=l.data});const v=d(!1),E=d(!1),p=d(null);ie(v,()=>{v.value?p.value.setCheckedNodes(ue(f.value)):p.value.setCheckedNodes([])});const F=Y(l=>{a.rules=p.value.getCheckedKeys()}),S=()=>{g.value?(y(f.value),g.value=!1):(B(f.value),g.value=!0)},B=l=>{Object.keys(l).forEach(e=>{p.value.store.nodesMap[l[e].menu_key].expanded=!0,l[e].children&&l[e].children.length>0&&y(l[e].children)})},y=l=>{Object.keys(l).forEach(e=>{p.value.store.nodesMap[l[e].menu_key].expanded=!1,l[e].children&&l[e].children.length>0&&y(l[e].children)})},x={role_id:0,role_name:"",status:1,rules:[]},a=me({...x}),C=d(),I=ce(()=>({role_name:[{required:!0,message:t("roleNamePlaceholder"),trigger:"blur"}],rules:[{validator:(l,e,o)=>{e.length?o():o(new Error(t("rulesPlaceholder")))},trigger:"blur"}]})),M=async l=>{if(c.value||!l)return;const e=a.role_id?Q:W;await l.validate(async o=>{if(o){c.value=!0;const u=Object.assign({},a);u.rules=u.rules.concat(p.value.getHalfCheckedKeys()),e(u).then(n=>{c.value=!1,_.value=!1,U("complete")}).catch(()=>{c.value=!1})}})},T=async(l=null)=>{if(c.value=!0,v.value=!1,Object.assign(a,x),k=t("addRole"),l){k=t("updateRole");const e=await(await X(l.role_id)).data;Object.keys(a).forEach(o=>{if(e[o]!=null)if(o=="rules"){e.rules;var u=[];Object.keys(e.rules).forEach(n=>{R(e.rules[n],f.value,u)}),a[o]=u}else a[o]=e[o]})}c.value=!1};function R(l,e,o){Object.keys(e).forEach(u=>{let n=e[u];n.menu_key==l?(!n.children||n.children.length==0)&&o.push(n.menu_key):n.children&&n.children.length>0&&R(l,n.children,o)})}return O({showDialog:_,setFormData:T}),(l,e)=>{const o=Z,u=L,n=ee,A=le,j=oe,V=te,P=ae,$=re,q=J,G=K,H=se;return D(),N(G,{modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=m=>_.value=m),title:s(k),width:"500px","destroy-on-close":!0},{footer:i(()=>[w("span",fe,[r(V,{onClick:e[5]||(e[5]=m=>_.value=!1)},{default:i(()=>[h(b(s(t)("cancel")),1)]),_:1}),r(V,{type:"primary",loading:c.value,onClick:e[6]||(e[6]=m=>M(C.value))},{default:i(()=>[h(b(s(t)("confirm")),1)]),_:1},8,["loading"])])]),default:i(()=>[de((D(),N(q,{model:a,"label-width":"90px",ref_key:"formRef",ref:C,rules:s(I),class:"page-form"},{default:i(()=>[r(u,{label:s(t)("roleName"),prop:"role_name"},{default:i(()=>[r(o,{modelValue:a.role_name,"onUpdate:modelValue":e[0]||(e[0]=m=>a.role_name=m),placeholder:s(t)("roleNamePlaceholder"),clearable:"",disabled:a.uid,class:"input-width",maxlength:"10","show-word-limit":!0},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["label"]),r(u,{label:s(t)("status")},{default:i(()=>[r(A,{modelValue:a.status,"onUpdate:modelValue":e[1]||(e[1]=m=>a.status=m)},{default:i(()=>[r(n,{label:1},{default:i(()=>[h(b(s(t)("startUsing")),1)]),_:1}),r(n,{label:0},{default:i(()=>[h(b(s(t)("statusDeactivate")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),r(u,{label:s(t)("permission"),prop:"rules"},{default:i(()=>[w("div",pe,[w("div",null,[r(j,{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=m=>v.value=m),label:s(t)("selectAll")},null,8,["modelValue","label"]),r(j,{modelValue:E.value,"onUpdate:modelValue":e[3]||(e[3]=m=>E.value=m),label:s(t)("checkStrictly")},null,8,["modelValue","label"])]),r(V,{link:"",type:"primary",onClick:e[4]||(e[4]=m=>S())},{default:i(()=>[h(b(s(t)("foldText")),1)]),_:1})]),r($,{height:"35vh",class:"w-full"},{default:i(()=>[r(P,{data:f.value,props:{label:"menu_name"},"default-checked-keys":a.rules,"check-strictly":E.value,"show-checkbox":"","default-expand-all":"",onCheckChange:s(F),"node-key":"menu_key",ref_key:"treeRef",ref:p},null,8,["data","default-checked-keys","check-strictly","onCheckChange"])]),_:1})]),_:1},8,["label"])]),_:1},8,["model","rules"])),[[H,c.value]])]),_:1},8,["modelValue","title"])}}});export{ll as default};
