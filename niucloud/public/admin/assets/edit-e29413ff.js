/* empty css             *//* empty css                   *//* empty css                  *//* empty css                */import{a as Z,E as ee}from"./el-form-item-144bc604.js";/* empty css                 *//* empty css               *//* empty css                  *//* empty css                  */import{at as V,ac as te,au as le}from"./index-1bbcede8.js";/* empty css                  *//* empty css                    */import{v as G}from"./event-3e082a4a.js";import{t as o}from"./index-3862e13d.js";import{g as ae,e as ie,a as de}from"./shop_address-1e69a57f.js";import{u as oe}from"./vue-router-9f815af7.js";import{c as re,l as se,a as ne}from"./qqmap-237c7a77.js";import{E as ce}from"./index-784d7581.js";import{E as ue}from"./index-5f2625ed.js";import{a as pe,E as me}from"./index-b7b91fcb.js";import{E as _e}from"./index-c5af06c2.js";import{E as fe}from"./index-6f670765.js";import{v as ve}from"./directive-d226d53f.js";import{d as ye,r as b,M,o as be,c as ge,w as g,b as _,e as w,f as p,x as L,u as n,L as k,m as x,p as u,q as r,F as S,t as j,v as K}from"./runtime-core.esm-bundler-c17ab5bc.js";import"./index-9ef6974e.js";import"./plugin-vue_export-helper-c018272e.js";import"./_baseClone-37ba2e68.js";import"./common-a45d855f.js";import"./index-0d36ccbf.js";import"./el-main-03d12282.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./index-e42600b8.js";import"./el-overlay-380df695.js";import"./index-93efb1b5.js";import"./focus-trap-c0148071.js";import"./index-4b62c73a.js";import"./index-332680c2.js";import"./index-a6ffcea0.js";import"./index-138bfa06.js";import"./index-72bf6cb5.js";import"./isEqual-ca98cf0c.js";import"./index-5c20ff8f.js";import"./strings-e72e60f7.js";import"./debounce-196ce6a6.js";import"./index-bfecf17f.js";import"./validator-f5e079db.js";const he={class:"main-container"},Ve={class:"detail-head"},we=p("span",{class:"iconfont iconxiangzuojiantou !text-xs"},null,-1),Le={class:"ml-[1px]"},ke=p("span",{class:"adorn"},"|",-1),xe={class:"right"},Ee={class:"flex flex-col"},Pe={id:"container",class:"w-[800px] h-[520px] relative"},Ce={class:"fixed-footer-wrap"},Ae={class:"fixed-footer !z-[1000]"},kt=ye({__name:"edit",setup(Re){const B=oe(),E=parseInt(B.query.id),f=b(!1),H=B.meta.title,m=M({province:[],city:[],district:[]}),P=b(),C=b(),A=b();V(0).then(a=>{m.province=a.data});let R="";be(()=>{const a=document.createElement("script");te().then(t=>{R=t.data.key,a.type="text/javascript",a.src="https://map.qq.com/api/gljs?libraries=tools,service&v=1.exp&key="+t.data.key,document.body.appendChild(a)}),a.onload=()=>{setTimeout(()=>{J()},500)}});let y,T;const D=b(!0),J=()=>{const a=window.TMap,t=a.LatLng,l=new t(e.lat,e.lng);y=new a.Map("container",{center:l,zoom:14}),y.on("tilesloaded",()=>{D.value=!1}),T=re(y),y.on("click",d=>{y.setCenter(d.latLng),T.updateGeometries({id:"center",position:d.latLng}),F(d.latLng.lat,d.latLng.lng)}),F(l.lat,l.lng)},c=M({province_id:0,city_id:0,district_id:0}),F=(a,t)=>{se({mapKey:R,lat:a,lng:t}).then(({message:l,result:d})=>{l=="query ok"&&(e.lat=d.location.lat,e.lng=d.location.lng,e.address=d.formatted_addresses.recommend,le(d.ad_info.adcode).then(({data:s})=>{c.province_id=s.province?s.province.id:0,c.city_id=s.city?s.city.id:0,c.district_id=s.district?s.district.id:0}))}).catch(l=>{console.log(l)})},N={id:0,contact_name:"",mobile:"",province_id:0,city_id:0,district_id:0,address:"",full_address:"",lat:39.908626,lng:116.39719,is_delivery_address:0,is_refund_address:0,is_default_delivery:0,is_default_refund:0},e=M({...N});E&&(async(a=0)=>{f.value=!0,Object.assign(e,N);const t=await(await ae(a)).data;Object.keys(e).forEach(l=>{t[l]!=null&&(e[l]=t[l])}),f.value=!1})(E);const I=b(),Q=ge(()=>({address_type:[{validator:(a,t,l)=>{!e.is_delivery_address&&!e.is_refund_address&&l(new Error(o("addressTypeRequire"))),l()}}],contact_name:[{required:!0,message:o("contactNamePlaceholder"),trigger:"blur"}],mobile:[{required:!0,message:o("mobilePlaceholder"),trigger:"blur"}],address_area:[{validator:(a,t,l)=>{e.province_id||l(new Error(o("provincePlaceholder"))),e.city_id||l(new Error(o("cityPlaceholder"))),m.district.length&&!e.district_id&&l(new Error(o("districtPlaceholder"))),l()}}],address:[{required:!0,message:o("addressPlaceholder"),trigger:"blur"}]}));g(()=>e.province_id,a=>{a?V(e.province_id).then(t=>{m.city=t.data;const l=e.city_id;if(l){let d=!1;for(let s=0;s<t.data.length;s++)if(l==t.data[s].id){d=!0;break}if(d){e.city_id=l;return}}e.city_id=0,q()}):e.city_id=0}),g(()=>e.city_id,a=>{a?V(e.city_id).then(t=>{m.district=t.data;const l=e.district_id;if(l){let d=!1;for(let s=0;s<t.data.length;s++)if(l==t.data[s].id){d=!0;break}if(d){e.district_id=l;return}}q(),e.district_id=0}):e.district_id=0}),g(()=>e.district_id,a=>{a&&q()});const q=()=>{setTimeout(()=>{const a=[e.province_id?P.value.selectedLabel:"",e.city_id?C.value.selectedLabel:"",e.district_id?A.value.selectedLabel:""];ne({mapKey:R,address:a.join("")}).then(({message:t,result:l})=>{if(t=="query ok"){const d=new window.TMap.LatLng(l.location.lat,l.location.lng);y.setCenter(d),T.updateGeometries({id:"center",position:d})}})},500)};g(()=>c.province_id,a=>{a&&V(c.province_id).then(t=>{m.city=t.data,e.province_id=c.province_id,e.city_id=c.city_id})}),g(()=>c.city_id,a=>{a&&V(c.city_id).then(t=>{m.district=t.data,e.city_id=c.city_id,e.district_id=c.district_id})}),g(()=>c.district_id,a=>{a&&(e.district_id=c.district_id)});const W=async a=>{f.value||!a||await a.validate(async t=>{if(t){f.value=!0;const l=e,d=[l.province_id?P.value.selectedLabel:"",l.city_id?C.value.selectedLabel:"",l.district_id?A.value.selectedLabel:"",l.address];l.full_address=d.join(""),(E?ie:de)(l).then(v=>{f.value=!1,history.back()}).catch(()=>{f.value=!1})}})},z=()=>{history.back()};return(a,t)=>{const l=ce,d=Z,s=ue,v=pe,U=me,X=ee,Y=_e,O=fe,$=ve;return _(),w("div",he,[p("div",Ve,[p("div",{class:"left",onClick:t[0]||(t[0]=i=>z())},[we,p("span",Le,L(n(o)("returnToPreviousPage")),1)]),ke,p("span",xe,L(n(H)),1)]),k((_(),x(Y,{class:"box-card !border-none",shadow:"never"},{default:u(()=>[r(X,{model:e,"label-width":"90px",ref_key:"formRef",ref:I,rules:n(Q),class:"page-form"},{default:u(()=>[r(d,{label:n(o)("addressType"),prop:"address_type"},{default:u(()=>[p("div",Ee,[p("div",null,[r(l,{modelValue:e.is_delivery_address,"onUpdate:modelValue":t[1]||(t[1]=i=>e.is_delivery_address=i),label:n(o)("deliveryAddress"),"true-label":1,"false-label":0},null,8,["modelValue","label"]),k(r(l,{modelValue:e.is_default_delivery,"onUpdate:modelValue":t[2]||(t[2]=i=>e.is_default_delivery=i),label:n(o)("defaultDeliveryAddress"),"true-label":1,"false-label":0},null,8,["modelValue","label"]),[[G,e.is_delivery_address]])]),p("div",null,[r(l,{modelValue:e.is_refund_address,"onUpdate:modelValue":t[3]||(t[3]=i=>e.is_refund_address=i),label:n(o)("refundAddress"),"true-label":1,"false-label":0},null,8,["modelValue","label"]),k(r(l,{modelValue:e.is_default_refund,"onUpdate:modelValue":t[4]||(t[4]=i=>e.is_default_refund=i),label:n(o)("defaultRefundAddress"),"true-label":1,"false-label":0},null,8,["modelValue","label"]),[[G,e.is_refund_address]])])])]),_:1},8,["label"]),r(d,{label:n(o)("contactName"),prop:"contact_name"},{default:u(()=>[r(s,{modelValue:e.contact_name,"onUpdate:modelValue":t[5]||(t[5]=i=>e.contact_name=i),clearable:"",placeholder:n(o)("contactNamePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(d,{label:n(o)("mobile"),prop:"mobile"},{default:u(()=>[r(s,{modelValue:e.mobile,"onUpdate:modelValue":t[6]||(t[6]=i=>e.mobile=i),clearable:"",placeholder:n(o)("mobilePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(d,{label:n(o)("fullAddress"),prop:"address_area"},{default:u(()=>[r(U,{modelValue:e.province_id,"onUpdate:modelValue":t[7]||(t[7]=i=>e.province_id=i),"value-key":"id",clearable:"",class:"w-[200px]",ref_key:"provinceRef",ref:P},{default:u(()=>[r(v,{label:n(o)("provincePlaceholder"),value:0},null,8,["label"]),(_(!0),w(S,null,j(m.province,(i,h)=>(_(),x(v,{key:h,label:i.name,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),r(U,{modelValue:e.city_id,"onUpdate:modelValue":t[8]||(t[8]=i=>e.city_id=i),"value-key":"id",clearable:"",class:"w-[200px] ml-3",ref_key:"cityRef",ref:C},{default:u(()=>[r(v,{label:n(o)("cityPlaceholder"),value:0},null,8,["label"]),(_(!0),w(S,null,j(m.city,(i,h)=>(_(),x(v,{key:h,label:i.name,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),r(U,{modelValue:e.district_id,"onUpdate:modelValue":t[9]||(t[9]=i=>e.district_id=i),"value-key":"id",clearable:"",class:"w-[200px] ml-3",ref_key:"districtRef",ref:A},{default:u(()=>[r(v,{label:n(o)("districtPlaceholder"),value:0},null,8,["label"]),(_(!0),w(S,null,j(m.district,(i,h)=>(_(),x(v,{key:h,label:i.name,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),r(d,{prop:"address"},{default:u(()=>[r(s,{modelValue:e.address,"onUpdate:modelValue":t[10]||(t[10]=i=>e.address=i),clearable:"",placeholder:n(o)("addressPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1}),r(d,null,{default:u(()=>[k(p("div",Pe,null,512),[[$,D.value]])]),_:1})]),_:1},8,["model","rules"])]),_:1})),[[$,f.value]]),p("div",Ce,[p("div",Ae,[r(O,{type:"primary",onClick:t[11]||(t[11]=i=>W(I.value))},{default:u(()=>[K(L(n(o)("save")),1)]),_:1}),r(O,{onClick:t[12]||(t[12]=i=>z())},{default:u(()=>[K(L(n(o)("cancel")),1)]),_:1})])])])}}});export{kt as default};
