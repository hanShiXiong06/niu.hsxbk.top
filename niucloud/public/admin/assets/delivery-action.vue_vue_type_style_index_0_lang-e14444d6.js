/* empty css             *//* empty css                   */import{E as K}from"./el-overlay-380df695.js";/* empty css                  *//* empty css                        *//* empty css                    *//* empty css               */import"./el-tooltip-4ed993c7.js";/* empty css                  */import"./index-1bbcede8.js";import{a as Q,E as W}from"./el-form-item-144bc604.js";/* empty css                 *//* empty css                  *//* empty css                  *//* empty css                       *//* empty css                 */import{t as r}from"./index-3862e13d.js";import{g as X}from"./delivery-3b5821cf.js";import{o as Y,g as Z}from"./order-09a5ee1d.js";/* empty css                   */import{c as F}from"./cloneDeep-028669bf.js";import{a as ee}from"./index-a6ffcea0.js";import{E as le,b as oe}from"./index-6ff31475.js";import{a as re,E as te}from"./index-b7b91fcb.js";import{E as ae}from"./index-5f2625ed.js";import{a as se,E as ie}from"./index-6191b0b4.js";import{E as ne}from"./index-6f670765.js";import{v as de}from"./directive-d226d53f.js";import{d as pe,r as u,M as ue,c as me,b as m,m as v,p as i,f as _e,q as a,v as x,x as h,u as s,L as ce,e as E,F as P,t as T,C as S}from"./runtime-core.esm-bundler-c17ab5bc.js";const ve={class:"dialog-footer"},Ke=pe({__name:"delivery-action",emits:["complete"],setup(ye,{expose:B,emit:R}){const _=u(!1),p=u(!1),V=u([]),D=u(!1),y=u([]);X({}).then(l=>{V.value=l.data.data});const k=u([]),o=ue({...{order_id:0,delivery_type:"",express_company_id:"",express_number:"",order_goods_ids:[]}}),w=u(),q=me(()=>({delivery_type:[{required:!0,message:r("deliveryTypePlaceholder"),trigger:"blur"}],express_company_id:[{required:!0,validator:L,trigger:"blur"}],express_number:[{required:!0,validator:U,trigger:"blur"}]})),L=(l,e,n)=>{o.delivery_type=="express"&&e===""?n(new Error(r("companyPlaceholder"))):n()},U=(l,e,n)=>{o.delivery_type=="express"&&e===""?n(new Error(r("expressNumberPlaceholder"))):n()},O=(l,e)=>l.status!=2,d=u([]),C=()=>{if(d.value=F(k.value),o.delivery_type&&o.delivery_type=="virtual")for(const l in d.value)d.value[l].goods_type!="virtual"&&d.value.splice(l,1);else if(o.delivery_type&&o.delivery_type!="virtual")for(const l in d.value)d.value[l].goods_type=="virtual"&&d.value.splice(l,1)},A=l=>{o.order_goods_ids=F([]);for(const e in l)o.order_goods_ids.push(l[e].order_goods_id)},G=async l=>{if(!(p.value||!l)){if(o.order_goods_ids.length<=0){ee({message:r("orderGoodsPlaceholder"),type:"warning"});return}await l.validate(async e=>{e&&(p.value=!0,Y(o).then(f=>{p.value=!1,_.value=!1,R("complete")}).catch(f=>{p.value=!1}))})}};return B({showDialog:_,setFormData:async(l=null)=>{if(p.value=!0,l){o.order_id=l.order_id,o.delivery_type="",k.value=l.order_goods,d.value=l.order_goods,await Z({delivery_type:l.delivery_type}).then(e=>{y.value=e.data;for(const n in e.data){o.delivery_type=n;break}C()});for(let e=0;e<l.order_goods.length;e++)if(l.order_goods[e].goods_type=="virtual"){D.value=!0;break}D.value==!0&&Object.assign(y.value,{virtual:r("virtualDelivery")})}p.value=!1}}),(l,e)=>{const n=le,f=oe,g=Q,I=re,M=te,$=ae,j=W,c=se,z=ie,N=ne,H=K,J=de;return m(),v(H,{modelValue:_.value,"onUpdate:modelValue":e[5]||(e[5]=t=>_.value=t),title:s(r)("delivery"),width:"700px",class:"diy-dialog-wrap","destroy-on-close":!0},{footer:i(()=>[_e("span",ve,[a(N,{onClick:e[3]||(e[3]=t=>_.value=!1)},{default:i(()=>[x(h(s(r)("cancel")),1)]),_:1}),a(N,{type:"primary",loading:p.value,onClick:e[4]||(e[4]=t=>G(w.value))},{default:i(()=>[x(h(s(r)("confirm")),1)]),_:1},8,["loading"])])]),default:i(()=>[ce((m(),E("div",null,[a(j,{model:o,"label-width":"100px",ref_key:"formRef",ref:w,rules:s(q),class:"page-form mb-[30px]"},{default:i(()=>[a(g,{label:s(r)("deliveryType"),prop:"delivery_type"},{default:i(()=>[a(f,{modelValue:o.delivery_type,"onUpdate:modelValue":e[0]||(e[0]=t=>o.delivery_type=t),onChange:C},{default:i(()=>[(m(!0),E(P,null,T(y.value,(t,b)=>(m(),v(n,{label:b,key:b},{default:i(()=>[x(h(t),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),o.delivery_type=="express"?(m(),v(g,{key:0,label:s(r)("company"),prop:"express_company_id"},{default:i(()=>[a(M,{modelValue:o.express_company_id,"onUpdate:modelValue":e[1]||(e[1]=t=>o.express_company_id=t),placeholder:s(r)("companyPlaceholder"),class:"input-width"},{default:i(()=>[(m(!0),E(P,null,T(V.value,(t,b)=>(m(),v(I,{key:t.index,label:t.company_name,value:t.company_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])):S("",!0),o.delivery_type=="express"?(m(),v(g,{key:1,label:s(r)("expressNumber"),prop:"express_number"},{default:i(()=>[a($,{modelValue:o.express_number,"onUpdate:modelValue":e[2]||(e[2]=t=>o.express_number=t),clearable:"",placeholder:s(r)("expressNumberPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):S("",!0)]),_:1},8,["model","rules"]),a(z,{data:d.value,size:"large",onSelectionChange:A},{default:i(()=>[a(c,{type:"selection",width:"55",selectable:O}),a(c,{prop:"goods_name",label:s(r)("goodsName"),"min-width":"200"},null,8,["label"]),a(c,{prop:"num",label:s(r)("num"),"min-width":"80"},null,8,["label"]),a(c,{prop:"status_name",label:s(r)("refundStatusName"),"min-width":"120"},null,8,["label"]),a(c,{prop:"delivery_status_name",label:s(r)("deliveryStatusName"),"min-width":"120",align:"right"},null,8,["label"])]),_:1},8,["data"])])),[[J,p.value]])]),_:1},8,["modelValue","title"])}}});export{Ke as _};
