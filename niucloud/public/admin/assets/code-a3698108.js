import{d as ee,r as m,R as te,e as h,f as z,g as s,B as r,u as o,y as t,x as i,A as b,Q as ae,v as N,H as W}from"./base-d77b0726.js";/* empty css                   *//* empty css                   *//* empty css                */import{_ as oe}from"./index.vue_vue_type_style_index_0_lang-1c9e98d8.js";import"./el-form-item-4ed993c7.js";/* empty css                 *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                         *//* empty css                    */import{g as le,a as ne,b as pe,s as ie,c as se}from"./weapp-e8a59dfb.js";import{t as e}from"./index-f3c0482e.js";import{u as re,b as me}from"./vue-router-57155f94.js";import{g as ce}from"./module-10e88c90.js";import{E as F}from"./index-5b262c6a.js";import{a as de,E as ue}from"./index-09449e3d.js";import{a as _e,E as fe}from"./index-136e79ad.js";import{E as ge}from"./index-91bdda63.js";import{a as ve,E as he}from"./index-0d721416.js";import{E as be}from"./index-45cca80f.js";import{E as we}from"./index-f956e728.js";import{E as Ee}from"./index-2cf73bf7.js";import{E as xe}from"./index-c1eb81db.js";import{a as Ve,E as Ce}from"./index-68c5ad54.js";import{E as ye}from"./index-6a54cf26.js";import{v as Te}from"./directive-08cd03ab.js";import{_ as Be}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                    */import"./common-56ee0a80.js";import"./index-e37943c3.js";import"./index-331c6de1.js";import"./index-9e51ba8b.js";import"./typescript-defaf979.js";import"./aria-60e0cdc6.js";import"./index-de9bede2.js";import"./index-bbf3e154.js";import"./event-e06a23af.js";import"./index-a20d1a31.js";import"./index-e89181d8.js";import"./index-704f0685.js";import"./index-b3418ddc.js";import"./scroll-59301fd6.js";import"./vnode-5920e7a9.js";import"./aria-adfa05c5.js";import"./focus-trap-98fda164.js";import"./validator-7b087194.js";import"./index-6245131d.js";import"./strings-6a15e170.js";import"./index-f2dc9b9f.js";import"./index-40fcecbc.js";import"./index-74352d71.js";import"./_Uint8Array-2fd72219.js";import"./_initCloneObject-22d1caee.js";import"./index-52f984e1.js";import"./isEqual-030b54ca.js";import"./_isIterateeCall-ff5ab0b5.js";import"./debounce-8a1738b0.js";import"./index-ef0eb7b1.js";import"./index-a997ab1f.js";import"./index-45469947.js";import"./index-d1e433eb.js";const ke={class:"main-container min-h-[300px] p-5"},Ue={class:"flex justify-between items-center mb-[20px]"},De={class:"text-[20px]"},Pe={class:"indent-4"},ze={class:"mt-[50px]"},Ne={key:0,class:"text-error"},We={class:""},Fe={class:"mt-[16px] flex justify-end"},Re={class:"dialog-footer"},Ie=ee({__name:"code",setup(Le){const R=re(),w=me(),I=R.meta.title,y=m("1"),E=m(!1),n=te({page:1,limit:10,total:0,loading:!1,data:[]}),c=m({desc:""}),x=m("");ce().then(p=>{p.data.data&&p.data.data.auth_code&&(x.value=p.data.data.auth_code,M())}).catch(()=>{});const T=m({});le().then(p=>{T.value=p.data});const V=m("/website/channel/weapp/code"),L=p=>{w.push({path:V.value})},B=m(null),u=(p=1)=>{n.loading=!0,n.page=p,pe({page:n.page,limit:n.limit}).then(a=>{n.loading=!1,n.data=a.data.data,n.total=a.data.total,p==1&&n.data.length&&n.data[0].status==0&&D(n.data[0].task_key)}).catch(()=>{n.loading=!1})};u();const A=()=>{B.value.clearValidate()},_=m(!1),k=()=>{if(!x.value){S();return}if(!T.value.app_id){j();return}_.value||(_.value=!0,ie(c.value).then(p=>{u(),_.value=!1}).catch(()=>{_.value=!1}))},U=m(""),M=()=>{x.value&&ne().then(p=>{}).catch()},D=p=>{se(p).then(a=>{const d=a.data.data??[];if(d[0]&&d[0].length){const f=d[0][d[0].length-1];if(f.code==0){u();return}if(f.code==1&&f.percent==100){u();return}setTimeout(()=>{D(p)},2e3)}})},S=()=>{F.confirm(e("authTips"),e("warning"),{distinguishCancelAndClose:!0,confirmButtonText:e("toBind"),cancelButtonText:e("toNiucloud")}).then(()=>{w.push({path:"/app/authorize"})}).catch(p=>{p==="cancel"&&window.open("https://www.niucloud.com/product")})},j=()=>{F.confirm(e("weappTips"),e("warning"),{confirmButtonText:e("toSetting"),cancelButtonText:e("cancel")}).then(()=>{w.push({path:"/website/channel/weapp/config"})}).catch(p=>{})};return(p,a)=>{const d=de,f=ue,$=_e,H=fe,g=ge,v=ve,Q=be,q=he,G=we,J=Ee,P=xe,C=Ve,K=oe,O=Ce,X=ye,Y=Te;return h(),z("div",ke,[s("div",Ue,[s("span",De,r(o(I)),1)]),t(f,{modelValue:V.value,"onUpdate:modelValue":a[0]||(a[0]=l=>V.value=l),class:"demo-tabs",onTabChange:L},{default:i(()=>[t(d,{label:o(e)("weappAccessFlow"),name:"/website/channel/weapp"},null,8,["label"]),t(d,{label:o(e)("subscribeMessage"),name:"/website/channel/weapp/message"},null,8,["label"]),t(d,{label:o(e)("weappRelease"),name:"/website/channel/weapp/code"},null,8,["label"])]),_:1},8,["modelValue"]),t(J,{class:"box-card !border-none",shadow:"never"},{default:i(()=>[t(H,{modelValue:y.value,"onUpdate:modelValue":a[1]||(a[1]=l=>y.value=l)},{default:i(()=>[t($,{title:o(e)("operatePrompt"),name:"1"},{default:i(()=>[s("div",null,[s("p",Pe,r(o(e)("operatePromptTipsTwo")),1)])]),_:1},8,["title"])]),_:1},8,["modelValue"]),s("div",ze,[t(g,{type:"primary",onClick:k,loading:_.value},{default:i(()=>[b(r(o(e)("codeDownTwoDesc")),1)]),_:1},8,["loading"])]),ae((h(),N(q,{class:"mt-[15px]",data:n.data,size:"default"},{empty:i(()=>[s("span",null,r(o(e)("emptyData")),1)]),default:i(()=>[t(v,{prop:"version",label:o(e)("code"),align:"left"},null,8,["label"]),t(v,{prop:"status_name",label:o(e)("status"),align:"left"},{default:i(({row:l})=>[s("div",null,r(l.status_name),1),l.status==-1?(h(),z("div",Ne,r(o(e)("failReason"))+r(l.fail_reason),1)):W("",!0)]),_:1},8,["label"]),t(v,{prop:"create_time",label:o(e)("createTime"),align:"center"},null,8,["label"]),t(v,{label:o(e)("operation"),fixed:"right",align:"right","min-width":"120"},{default:i(({row:l,$index:Z})=>[s("div",We,[t(Q,{content:U.value,"raw-content":"",effect:"light"},{default:i(()=>[U.value&&Z==0&&n.page==1?(h(),N(g,{key:0,type:"primary",link:""},{default:i(()=>[b(r(o(e)("preview")),1)]),_:1})):W("",!0)]),_:2},1032,["content"])])]),_:1},8,["label"])]),_:1},8,["data"])),[[Y,n.loading]]),s("div",Fe,[t(G,{"current-page":n.page,"onUpdate:currentPage":a[2]||(a[2]=l=>n.page=l),"page-size":n.limit,"onUpdate:pageSize":a[3]||(a[3]=l=>n.limit=l),layout:"total, sizes, prev, pager, next, jumper",total:n.total,onSizeChange:u,onCurrentChange:u},null,8,["current-page","page-size","total"])])]),_:1}),t(X,{modelValue:E.value,"onUpdate:modelValue":a[8]||(a[8]=l=>E.value=l),title:o(e)("codeDownTwoDesc"),width:"30%","before-close":A},{footer:i(()=>[s("span",Re,[t(g,{onClick:a[7]||(a[7]=l=>E.value=!1)},{default:i(()=>[b(r(o(e)("cancel")),1)]),_:1}),t(g,{type:"primary",onClick:k},{default:i(()=>[b(r(o(e)("confirm")),1)]),_:1})])]),default:i(()=>[t(O,{ref_key:"ruleFormRef",ref:B,model:c.value,rules:p.rules,"label-width":"120px"},{default:i(()=>[t(C,{prop:"code",label:o(e)("code")},{default:i(()=>[t(P,{modelValue:c.value.code,"onUpdate:modelValue":a[4]||(a[4]=l=>c.value.code=l),placeholder:o(e)("codePlaceholder"),onkeyup:"this.value = this.value.replace(/[^\\d\\.]/g,'');"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(C,{prop:"path",label:o(e)("path")},{default:i(()=>[t(K,{modelValue:c.value.path,"onUpdate:modelValue":a[5]||(a[5]=l=>c.value.path=l),api:"weapp/upload",accept:".zip"},null,8,["modelValue","accept"])]),_:1},8,["label"]),t(C,{label:o(e)("content")},{default:i(()=>[t(P,{type:"textarea",modelValue:c.value.content,"onUpdate:modelValue":a[6]||(a[6]=l=>c.value.content=l),placeholder:o(e)("contentPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});const aa=Be(Ie,[["__scopeId","data-v-32a3683f"]]);export{aa as default};
