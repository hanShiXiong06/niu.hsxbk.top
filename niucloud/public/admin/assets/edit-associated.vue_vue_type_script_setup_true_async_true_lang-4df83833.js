import{d as S,r as d,c as I,e as u,v as f,x as s,g as O,y as t,A as P,B as C,u as r,f as _,F as b,z as h,al as z}from"./base-d77b0726.js";/* empty css                   *//* empty css                  *//* empty css                *//* empty css                 */import"./el-form-item-4ed993c7.js";/* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  */import{t as a}from"./index-70af0995.js";import{g as j,l as H,m as J}from"./tools-cb251091.js";import{c as x}from"./cloneDeep-52d1ae6a.js";import{a as Q,E as W}from"./index-a997ab1f.js";import{a as X,E as Y}from"./index-68c5ad54.js";import{E as Z}from"./index-c1eb81db.js";import{E as ee}from"./index-91bdda63.js";import{E as le}from"./index-6a54cf26.js";const ae={class:"dialog-footer"},Ee=S({__name:"edit-associated",props:{table_name:{type:String,required:!0}},emits:["complete"],setup(K,{expose:U,emit:q}){const B=K,m=d(!1);d(!1);const M=d(""),V={type:"has_one",name:"",addon:"system",model:"",local_key:"",foreign_key:""},o=d({...V}),v=d(),N=I(()=>({type:[{required:!0,message:a("associatedTypePlaceholder"),trigger:"change"}],name:[{required:!0,message:a("associatedNamePlaceholder"),trigger:"blur"}],model:[{required:!0,message:a("associatedModelPlaceholder"),trigger:"change"}],local_key:[{required:!0,message:a("localKeyPlaceholder"),trigger:"change"}],foreign_key:[{required:!0,message:a("foreignKeyPlaceholder"),trigger:"blur"}]})),k=d([]),w=()=>{H().then(n=>{k.value=n.data})},E=d([]),T=n=>{J({table_name:n}).then(l=>{E.value=l.data})},g=d([]);(async()=>{let{data:n}=await j({});g.value=[{title:"系统",key:"system"}],g.value.push(...n),w()})();const G=n=>{o.value.model="",w()},L=n=>{var l;(l=v.value)==null||l.clearValidate(),n()},R=async n=>{n&&await n.validate(async l=>{l&&(q("complete",z(o.value)),m.value=!1)})};return U({showDialog:m,setFormData:async(n=null)=>{T(B.table_name),n?o.value=x(n):o.value=x(V),m.value=!0}}),(n,l)=>{const i=Q,c=W,p=X,D=Z,$=Y,F=ee,A=le;return u(),f(A,{modelValue:m.value,"onUpdate:modelValue":l[8]||(l[8]=e=>m.value=e),title:M.value,width:"500px","before-close":L,"destroy-on-close":!0},{footer:s(()=>[O("span",ae,[t(F,{onClick:l[6]||(l[6]=e=>m.value=!1)},{default:s(()=>[P(C(r(a)("cancel")),1)]),_:1}),t(F,{type:"primary",onClick:l[7]||(l[7]=e=>R(v.value))},{default:s(()=>[P(C(r(a)("confirm")),1)]),_:1})])]),default:s(()=>[t($,{model:o.value,"label-width":"120px",ref_key:"formRef",ref:v,rules:r(N),class:"page-form"},{default:s(()=>[t(p,{label:r(a)("associatedType"),prop:"type"},{default:s(()=>[t(c,{placeholder:r(a)("associatedTypePlaceholder"),modelValue:o.value.type,"onUpdate:modelValue":l[0]||(l[0]=e=>o.value.type=e),class:"input-width"},{default:s(()=>[t(i,{label:r(a)("hasOne"),value:"has_one"},null,8,["label"]),t(i,{label:r(a)("hasMany"),value:"has_many"},null,8,["label"])]),_:1},8,["placeholder","modelValue"])]),_:1},8,["label"]),t(p,{label:r(a)("associatedName"),prop:"name"},{default:s(()=>[t(D,{modelValue:o.value.name,"onUpdate:modelValue":l[1]||(l[1]=e=>o.value.name=e),placeholder:r(a)("associatedNamePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(p,{label:r(a)("addons"),prop:"addon"},{default:s(()=>[t(c,{modelValue:o.value.addon,"onUpdate:modelValue":l[2]||(l[2]=e=>o.value.addon=e),placeholder:r(a)("addonsPlaceholder"),class:"input-width",onChange:G},{default:s(()=>[(u(!0),_(b,null,h(g.value,(e,y)=>(u(),f(i,{label:e.title,value:e.key,key:y},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),t(p,{label:r(a)("associatedModel"),prop:"model"},{default:s(()=>[t(c,{placeholder:r(a)("associatedModelPlaceholder"),modelValue:o.value.model,"onUpdate:modelValue":l[3]||(l[3]=e=>o.value.model=e),class:"input-width"},{default:s(()=>[(u(!0),_(b,null,h(k.value,e=>(u(),f(i,{label:e,value:e,key:e},null,8,["label","value"]))),128))]),_:1},8,["placeholder","modelValue"])]),_:1},8,["label"]),t(p,{prop:"local_key",label:r(a)("localKey")},{default:s(()=>[t(c,{class:"input-width",placeholder:r(a)("localKeyPlaceholder"),modelValue:o.value.local_key,"onUpdate:modelValue":l[4]||(l[4]=e=>o.value.local_key=e)},{default:s(()=>[(u(!0),_(b,null,h(E.value,(e,y)=>(u(),f(i,{label:`${e.name}:${e.comment}`,value:e.name,key:y},null,8,["label","value"]))),128))]),_:1},8,["placeholder","modelValue"])]),_:1},8,["label"]),t(p,{label:r(a)("foreignKey"),prop:"foreign_key"},{default:s(()=>[t(D,{modelValue:o.value.foreign_key,"onUpdate:modelValue":l[5]||(l[5]=e=>o.value.foreign_key=e),placeholder:r(a)("foreignKeyPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}});export{Ee as _};
