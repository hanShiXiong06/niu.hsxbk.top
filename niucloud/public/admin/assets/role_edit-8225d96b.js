import{d as Y,R as Z,r as R,a4 as ee,o as ae,E as te,al as L,w as oe,Q as le,u as e,e as c,f as b,g as u,B as f,v as U,x as n,y as s,A as E,H as x,i as B,F as se,z as re,bl as ne,bm as de}from"./base-d77b0726.js";/* empty css                   *//* empty css                  *//* empty css                    *//* empty css                *//* empty css                    *//* empty css                *//* empty css               *//* empty css                 */import"./el-form-item-4ed993c7.js";/* empty css                 */import{t as r}from"./index-c7fb4804.js";import{u as ie,v as me,s as ue,q as pe,r as ce}from"./sys-cbb25fd8.js";import{e as _e}from"./common-56ee0a80.js";import{u as fe,b as he}from"./vue-router-57155f94.js";import{_ as ve}from"./addon-role.vue_vue_type_script_setup_true_lang-5de10cd5.js";import{a as P}from"./index-9e51ba8b.js";import{E as ge}from"./index-c1eb81db.js";import{a as be,E as ye}from"./index-68c5ad54.js";import{E as ke,a as Ee}from"./index-c314892b.js";import{E as xe,b as Ve}from"./index-ee35aabd.js";import{E as we}from"./index-52f984e1.js";import{E as Ce}from"./index-5ee2b751.js";import{a as Re,E as Ne}from"./index-09449e3d.js";import{E as De}from"./index-91bdda63.js";import{v as Ie}from"./directive-08cd03ab.js";import{_ as je}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-a477ea57.js";import"./index-331c6de1.js";import"./index-e37943c3.js";import"./index-704f0685.js";import"./typescript-defaf979.js";import"./aria-60e0cdc6.js";import"./index-de9bede2.js";import"./event-e06a23af.js";import"./index-d1e433eb.js";import"./index-6245131d.js";import"./_Uint8Array-2fd72219.js";import"./_initCloneObject-22d1caee.js";import"./isEqual-030b54ca.js";import"./index-40fcecbc.js";import"./index-a20d1a31.js";import"./strings-6a15e170.js";import"./vnode-5920e7a9.js";import"./index-f2dc9b9f.js";const S=y=>(ne("data-v-4840634a"),y=y(),de(),y),Le={class:"main-container"},Ue={class:"detail-head"},Be=S(()=>u("span",{class:"iconfont iconxiangzuojiantou !text-xs"},null,-1)),Pe={class:"ml-[1px]"},Se=S(()=>u("span",{class:"adorn"},"|",-1)),Te={class:"right"},Ae={key:1,class:"px-[15px]"},Fe={class:"flex items-center justify-between"},Oe={key:2,class:"fixed-footer-wrap"},qe={class:"fixed-footer"},$e=Y({__name:"role_edit",setup(y){const V=fe(),w=he(),T=V.meta.title,h=Z({loading:!1,activeName:"system",checkAll:!1,formData:{role_name:"",status:1,addon:{},system:[]},menusData:[],addonList:[]});let N=R(null),A=R({role_name:[{required:!0,message:r("roleNamePlaceholder"),trigger:"blur"}],rules:[{validator:(d,a,o)=>{a.length?o():o(new Error(r("rulesPlaceholder")))},trigger:"blur"}]}),{loading:m,formData:t,activeName:k,checkAll:_,menusData:C,addonList:F}=ee(h);ae(async()=>{m.value=!0;let d=await ie();d.data&&(h.menusData=d.data);let a=await me();a.data&&(h.addonList=a.data.map(o=>(o.menu_name=o.title,o.menu_key=o.key,o))),V.query.role_id?O(V.query.role_id):m.value=!1});const O=d=>{ue(d).then(a=>{h.formData=Object.assign(t.value,a.data),t.value.addon=Object.assign(t.value.addon,t.value.rules.addon),t.value.system=Object.assign(t.value.system,t.value.rules.system),m.value=!1,te(()=>{var o=[];t.value.system.forEach(i=>D(i,L(C.value),o)),v.value.setCheckedKeys(o)})}).catch(()=>{m.value=!1})},D=(d,a,o)=>{a.forEach(i=>{d==i.menu_key?(!i.children||i.children.length==0)&&o.push(d):i.children&&i.children.length>0&&D(d,i.children,o)})};let v=R(null);oe(_,()=>{_.value?v.value.setCheckedNodes(L(C.value)):v.value.setCheckedNodes([])});const q=_e(d=>{h.formData.system=v.value.getCheckedNodes(!1,!0).map(a=>a.menu_key)}),$=async d=>{const a=t.value.role_id?pe:ce;await d.validate(async o=>{if(o){if(!t.value.system.length)return P({message:`${r("systemErr")}`}),!1;var i=Object.values(t.value.addon).filter(g=>{if(g.length)return!0});if(!i.length)return P({message:`${r("applicationErr")}`}),!1;const p=Object.assign({},t.value);p.rules={system:p.system,addon:p.addon},a(p).then(g=>{w.push({path:"/setting/auth/role"})}).catch(()=>{m.value=!1})}})};return(d,a)=>{const o=ge,i=be,p=ke,g=xe,z=Ve,M=Ee,G=ye,H=we,K=Ce,I=Re,Q=Ne,j=De,J=Ie;return le((c(),b("div",Le,[u("div",Ue,[u("div",{class:"left",onClick:a[0]||(a[0]=l=>e(w).push({path:"/setting/auth/role"}))},[Be,u("span",Pe,f(e(r)("returnToPreviousPage")),1)]),Se,u("span",Te,f(e(T)),1)]),e(m)?x("",!0):(c(),U(G,{key:0,model:e(t),"label-width":"90px",ref_key:"formRef",ref:N,rules:e(A),class:"page-form mt-[30px]"},{default:n(()=>[s(M,null,{default:n(()=>[s(p,{span:24},{default:n(()=>[s(i,{label:e(r)("roleName"),prop:"role_name"},{default:n(()=>[s(o,{modelValue:e(t).role_name,"onUpdate:modelValue":a[1]||(a[1]=l=>e(t).role_name=l),placeholder:e(r)("roleNamePlaceholder"),clearable:"",disabled:e(t).uid,class:"input-width",maxlength:"10","show-word-limit":!0},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["label"])]),_:1}),s(p,{span:24},{default:n(()=>[s(i,{label:e(r)("status")},{default:n(()=>[s(z,{modelValue:e(t).status,"onUpdate:modelValue":a[2]||(a[2]=l=>e(t).status=l)},{default:n(()=>[s(g,{label:1},{default:n(()=>[E(f(e(r)("startUsing")),1)]),_:1}),s(g,{label:0},{default:n(()=>[E(f(e(r)("statusDeactivate")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model","rules"])),e(m)?x("",!0):(c(),b("div",Ae,[s(Q,{modelValue:e(k),"onUpdate:modelValue":a[4]||(a[4]=l=>B(k)?k.value=l:k=l),class:"demo-tabs"},{default:n(()=>[s(I,{label:e(r)("system"),name:"system"},{default:n(()=>[u("div",Fe,[u("div",null,[s(H,{modelValue:e(_),"onUpdate:modelValue":a[3]||(a[3]=l=>B(_)?_.value=l:_=l),label:e(r)("selectAll")},null,8,["modelValue","label"])])]),s(K,{data:e(C),props:{label:"menu_name"},"show-checkbox":"",onCheckChange:e(q),"expand-on-click-node":!1,"node-key":"menu_key",ref_key:"treeRef",ref:v},null,8,["data","onCheckChange"])]),_:1},8,["label"]),s(I,{label:e(r)("application"),name:"application"},{default:n(()=>[(c(!0),b(se,null,re(e(F),(l,W)=>(c(),b("div",{key:W,class:"p-[15px] border-[1px] border-solid border-[#e4e7ed] mt-[15px]"},[l.children?(c(),U(ve,{key:0,modelValue:e(t).addon[l.key],"onUpdate:modelValue":X=>e(t).addon[l.key]=X,data:l},null,8,["modelValue","onUpdate:modelValue","data"])):x("",!0)]))),128))]),_:1},8,["label"])]),_:1},8,["modelValue"])])),e(m)?x("",!0):(c(),b("div",Oe,[u("div",qe,[s(j,{type:"primary",onClick:a[5]||(a[5]=l=>$(e(N)))},{default:n(()=>[E(f(e(r)("save")),1)]),_:1}),s(j,{onClick:a[6]||(a[6]=l=>e(w).push({path:"/setting/auth/role"}))},{default:n(()=>[E(f(e(r)("cancel")),1)]),_:1})])]))])),[[J,e(m)]])}}});const Ba=je($e,[["__scopeId","data-v-4840634a"]]);export{Ba as default};
