import{d as te,r as m,R as ae,e as b,f as W,g as r,B as s,u as o,y as t,x as i,A as v,Q as oe,v as D,H as F}from"./base-d77b0726.js";/* empty css                   *//* empty css                   *//* empty css                */import{_ as le}from"./index.vue_vue_type_style_index_0_lang-8b8044d5.js";import"./el-form-item-4ed993c7.js";/* empty css                 *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                         *//* empty css                    */import{g as ne,a as ie,b as pe,s as se,c as re}from"./weapp-9f9ae7ef.js";import{t as e}from"./index-e064b265.js";import{u as me,b as ce}from"./vue-router-57155f94.js";import{g as de}from"./module-5eb4d257.js";import{E as y}from"./index-5b262c6a.js";import{a as ue,E as _e}from"./index-09449e3d.js";import{a as fe,E as ge}from"./index-136e79ad.js";import{E as ve}from"./index-91bdda63.js";import{a as he,E as be}from"./index-0d721416.js";import{E as we}from"./index-45cca80f.js";import{E as xe}from"./index-f956e728.js";import{E as Ee}from"./index-2cf73bf7.js";import{E as Ve}from"./index-c1eb81db.js";import{a as Ce,E as Te}from"./index-68c5ad54.js";import{E as ye}from"./index-6a54cf26.js";import{v as Be}from"./directive-08cd03ab.js";import{_ as ke}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                    */import"./common-56ee0a80.js";import"./index-e37943c3.js";import"./index-331c6de1.js";import"./index-9e51ba8b.js";import"./typescript-defaf979.js";import"./aria-60e0cdc6.js";import"./index-de9bede2.js";import"./index-bbf3e154.js";import"./event-e06a23af.js";import"./index-a20d1a31.js";import"./index-24e005c6.js";import"./index-704f0685.js";import"./index-b3418ddc.js";import"./scroll-59301fd6.js";import"./vnode-5920e7a9.js";import"./aria-adfa05c5.js";import"./focus-trap-98fda164.js";import"./validator-7b087194.js";import"./index-6245131d.js";import"./strings-6a15e170.js";import"./index-f2dc9b9f.js";import"./index-40fcecbc.js";import"./index-74352d71.js";import"./_Uint8Array-2fd72219.js";import"./_initCloneObject-22d1caee.js";import"./index-52f984e1.js";import"./isEqual-030b54ca.js";import"./_isIterateeCall-ff5ab0b5.js";import"./debounce-8a1738b0.js";import"./index-ef0eb7b1.js";import"./index-a997ab1f.js";import"./index-45469947.js";import"./index-d1e433eb.js";const Ue={class:"main-container min-h-[300px] p-5"},Pe={class:"flex justify-between items-center mb-[20px]"},Re={class:"text-[20px]"},ze={class:"indent-4"},Ne={class:"mt-[50px]"},We={key:0,class:"text-error"},De={class:""},Fe={class:"mt-[16px] flex justify-end"},Ie={class:"dialog-footer"},Le=te({__name:"code",setup(Ae){const I=me(),w=ce(),L=I.meta.title,B=m("1"),x=m(!1),p=ae({page:1,limit:10,total:0,loading:!1,data:[]}),c=m({desc:""}),E=m("");de().then(l=>{l.data.data&&l.data.data.auth_code&&(E.value=l.data.data.auth_code,R())}).catch(()=>{});const k=m({});ne().then(l=>{k.value=l.data});const V=m("/website/channel/weapp/code"),A=l=>{w.push({path:V.value})},U=m(null),u=(l=1)=>{p.loading=!0,p.page=l,pe({page:p.page,limit:p.limit}).then(a=>{p.loading=!1,p.data=a.data.data,p.total=a.data.total,l==1&&p.data.length&&p.data[0].status==0&&z(p.data[0].task_key)}).catch(()=>{p.loading=!1})};u();const M=()=>{U.value.clearValidate()},_=m(!1),P=()=>{if(!E.value){j();return}if(!k.value.app_id){$();return}_.value||(_.value=!0,se(c.value).then(l=>{u(),_.value=!1}).catch(()=>{_.value=!1}))},S=()=>{y.alert(e("localInsertTips"),e("warning"),{confirmButtonText:e("confirm")})},C=m(""),R=()=>{E.value&&ie().then(l=>{l.data&&(C.value=`<img src="${l.data}" class="w-[150px]">`)}).catch()},z=l=>{re(l).then(a=>{const d=a.data.data??[];if(d[0]&&d[0].length){const f=d[0][d[0].length-1];if(f.code==0){u();return}if(f.code==1&&f.percent==100){u(),R();return}setTimeout(()=>{z(l)},2e3)}})},j=()=>{y.confirm(e("authTips"),e("warning"),{distinguishCancelAndClose:!0,confirmButtonText:e("toBind"),cancelButtonText:e("toNiucloud")}).then(()=>{w.push({path:"/app/authorize"})}).catch(l=>{l==="cancel"&&window.open("https://www.niucloud.com/product")})},$=()=>{y.confirm(e("weappTips"),e("warning"),{confirmButtonText:e("toSetting"),cancelButtonText:e("cancel")}).then(()=>{w.push({path:"/website/channel/weapp/config"})}).catch(l=>{})};return(l,a)=>{const d=ue,f=_e,H=fe,Q=ge,g=ve,h=he,q=we,G=be,J=xe,K=Ee,N=Ve,T=Ce,O=le,X=Te,Y=ye,Z=Be;return b(),W("div",Ue,[r("div",Pe,[r("span",Re,s(o(L)),1)]),t(f,{modelValue:V.value,"onUpdate:modelValue":a[0]||(a[0]=n=>V.value=n),class:"demo-tabs",onTabChange:A},{default:i(()=>[t(d,{label:o(e)("weappAccessFlow"),name:"/website/channel/weapp"},null,8,["label"]),t(d,{label:o(e)("subscribeMessage"),name:"/website/channel/weapp/message"},null,8,["label"]),t(d,{label:o(e)("weappRelease"),name:"/website/channel/weapp/code"},null,8,["label"])]),_:1},8,["modelValue"]),t(K,{class:"box-card !border-none",shadow:"never"},{default:i(()=>[t(Q,{modelValue:B.value,"onUpdate:modelValue":a[1]||(a[1]=n=>B.value=n)},{default:i(()=>[t(H,{title:o(e)("operatePrompt"),name:"1"},{default:i(()=>[r("div",null,[r("p",ze,s(o(e)("operatePromptTipsTwo")),1)])]),_:1},8,["title"])]),_:1},8,["modelValue"]),r("div",Ne,[t(g,{type:"primary",onClick:P,loading:_.value},{default:i(()=>[v(s(o(e)("cloudRelease")),1)]),_:1},8,["loading"]),t(g,{onClick:S},{default:i(()=>[v(s(o(e)("localRelease")),1)]),_:1})]),oe((b(),D(G,{class:"mt-[15px]",data:p.data,size:"default"},{empty:i(()=>[r("span",null,s(o(e)("emptyData")),1)]),default:i(()=>[t(h,{prop:"version",label:o(e)("code"),align:"left"},null,8,["label"]),t(h,{prop:"status_name",label:o(e)("status"),align:"left"},{default:i(({row:n})=>[r("div",null,s(n.status_name),1),n.status==-1?(b(),W("div",We,s(o(e)("failReason"))+s(n.fail_reason),1)):F("",!0)]),_:1},8,["label"]),t(h,{prop:"create_time",label:o(e)("createTime"),align:"center"},null,8,["label"]),t(h,{label:o(e)("operation"),fixed:"right",align:"right","min-width":"120"},{default:i(({row:n,$index:ee})=>[r("div",De,[t(q,{content:C.value,"raw-content":"",effect:"light"},{default:i(()=>[C.value&&ee==0&&p.page==1?(b(),D(g,{key:0,type:"primary",link:""},{default:i(()=>[v(s(o(e)("preview")),1)]),_:1})):F("",!0)]),_:2},1032,["content"])])]),_:1},8,["label"])]),_:1},8,["data"])),[[Z,p.loading]]),r("div",Fe,[t(J,{"current-page":p.page,"onUpdate:currentPage":a[2]||(a[2]=n=>p.page=n),"page-size":p.limit,"onUpdate:pageSize":a[3]||(a[3]=n=>p.limit=n),layout:"total, sizes, prev, pager, next, jumper",total:p.total,onSizeChange:u,onCurrentChange:u},null,8,["current-page","page-size","total"])])]),_:1}),t(Y,{modelValue:x.value,"onUpdate:modelValue":a[8]||(a[8]=n=>x.value=n),title:o(e)("codeDownTwoDesc"),width:"30%","before-close":M},{footer:i(()=>[r("span",Ie,[t(g,{onClick:a[7]||(a[7]=n=>x.value=!1)},{default:i(()=>[v(s(o(e)("cancel")),1)]),_:1}),t(g,{type:"primary",onClick:P},{default:i(()=>[v(s(o(e)("confirm")),1)]),_:1})])]),default:i(()=>[t(X,{ref_key:"ruleFormRef",ref:U,model:c.value,rules:l.rules,"label-width":"120px"},{default:i(()=>[t(T,{prop:"code",label:o(e)("code")},{default:i(()=>[t(N,{modelValue:c.value.code,"onUpdate:modelValue":a[4]||(a[4]=n=>c.value.code=n),placeholder:o(e)("codePlaceholder"),onkeyup:"this.value = this.value.replace(/[^\\d\\.]/g,'');"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(T,{prop:"path",label:o(e)("path")},{default:i(()=>[t(O,{modelValue:c.value.path,"onUpdate:modelValue":a[5]||(a[5]=n=>c.value.path=n),api:"weapp/upload",accept:".zip"},null,8,["modelValue","accept"])]),_:1},8,["label"]),t(T,{label:o(e)("content")},{default:i(()=>[t(N,{type:"textarea",modelValue:c.value.content,"onUpdate:modelValue":a[6]||(a[6]=n=>c.value.content=n),placeholder:o(e)("contentPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});const oa=ke(Le,[["__scopeId","data-v-f751e723"]]);export{oa as default};
