import{d as Y,R as Z,r as R,a4 as ee,o as ae,E as te,an as P,w as oe,Q as le,u as e,e as c,f as y,g as u,B as f,v as j,x as r,y as s,A as E,H as x,i as U,F as se,z as ne,aP as re,aQ as de}from"./base-06478700.js";/* empty css                   *//* empty css                  *//* empty css                    *//* empty css                *//* empty css                    */import{a as ie,E as me}from"./el-form-item-314d006d.js";/* empty css               *//* empty css                 *//* empty css                 */import{t as n}from"./index-7ea27073.js";import{O as ue,P as pe,M as ce,K as _e,L as fe}from"./index-00549cce.js";import{e as he}from"./common-92a35870.js";import{u as ve,a as ge}from"./vue-router-d09a2c28.js";import{_ as ye}from"./addon-role.vue_vue_type_script_setup_true_lang-4f3b312a.js";import{a as B}from"./index-b52d0f2a.js";import{E as be}from"./index-b68e8463.js";import{E as ke,a as Ee}from"./index-c17093ae.js";import{E as xe,b as Ve}from"./index-6290cf08.js";import{E as we}from"./index-40e21e72.js";import{E as Ce}from"./index-6a9a5926.js";import{a as Re,E as Ne}from"./index-0d66b73c.js";import{E as De}from"./index-c2f001d3.js";import{v as Ie}from"./directive-cb2d3366.js";import{_ as Le}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-2fcd1254.js";import"./event-10eba222.js";import"./index-adb89d14.js";import"./el-main-9a0960e7.js";import"./index-6b67c4ac.js";import"./el-overlay-42a687c6.js";import"./index-9fe5de95.js";import"./focus-trap-3e826cdc.js";import"./index-f27d6ce0.js";import"./index-818c0ce2.js";import"./el-tooltip-58212670.js";import"./index-2a269c7c.js";import"./index-e4abfaa5.js";import"./index-9ee9102c.js";import"./isEqual-42d4b10f.js";import"./strings-fe930bc4.js";const O=b=>(re("data-v-4840634a"),b=b(),de(),b),Pe={class:"main-container"},je={class:"detail-head"},Ue=O(()=>u("span",{class:"iconfont iconxiangzuojiantou !text-xs"},null,-1)),Be={class:"ml-[1px]"},Oe=O(()=>u("span",{class:"adorn"},"|",-1)),Se={class:"right"},Te={key:1,class:"px-[15px]"},Ae={class:"flex items-center justify-between"},Fe={key:2,class:"fixed-footer-wrap"},$e={class:"fixed-footer"},qe=Y({__name:"role_edit",setup(b){const V=ve(),w=ge(),S=V.meta.title,h=Z({loading:!1,activeName:"system",checkAll:!1,formData:{role_name:"",status:1,addon:{},system:[]},menusData:[],addonList:[]});let N=R(null),T=R({role_name:[{required:!0,message:n("roleNamePlaceholder"),trigger:"blur"}],rules:[{validator:(d,a,o)=>{a.length?o():o(new Error(n("rulesPlaceholder")))},trigger:"blur"}]}),{loading:m,formData:t,activeName:k,checkAll:_,menusData:C,addonList:A}=ee(h);ae(async()=>{m.value=!0;let d=await ue();d.data&&(h.menusData=d.data);let a=await pe();a.data&&(h.addonList=a.data.map(o=>(o.menu_name=o.title,o.menu_key=o.key,o))),V.query.role_id?F(V.query.role_id):m.value=!1});const F=d=>{ce(d).then(a=>{h.formData=Object.assign(t.value,a.data),t.value.addon=Object.assign(t.value.addon,t.value.rules.addon),t.value.system=Object.assign(t.value.system,t.value.rules.system),m.value=!1,te(()=>{var o=[];t.value.system.forEach(i=>D(i,P(C.value),o)),v.value.setCheckedKeys(o)})}).catch(()=>{m.value=!1})},D=(d,a,o)=>{a.forEach(i=>{d==i.menu_key?(!i.children||i.children.length==0)&&o.push(d):i.children&&i.children.length>0&&D(d,i.children,o)})};let v=R(null);oe(_,()=>{_.value?v.value.setCheckedNodes(P(C.value)):v.value.setCheckedNodes([])});const $=he(d=>{h.formData.system=v.value.getCheckedNodes(!1,!0).map(a=>a.menu_key)}),q=async d=>{const a=t.value.role_id?_e:fe;await d.validate(async o=>{if(o){if(!t.value.system.length)return B({message:`${n("systemErr")}`}),!1;var i=Object.values(t.value.addon).filter(g=>{if(g.length)return!0});if(!i.length)return B({message:`${n("applicationErr")}`}),!1;const p=Object.assign({},t.value);p.rules={system:p.system,addon:p.addon},a(p).then(g=>{w.push({path:"/setting/auth/role"})}).catch(()=>{m.value=!1})}})};return(d,a)=>{const o=be,i=ie,p=ke,g=xe,M=Ve,z=Ee,K=me,Q=we,G=Ce,I=Re,H=Ne,L=De,J=Ie;return le((c(),y("div",Pe,[u("div",je,[u("div",{class:"left",onClick:a[0]||(a[0]=l=>e(w).push({path:"/setting/auth/role"}))},[Ue,u("span",Be,f(e(n)("returnToPreviousPage")),1)]),Oe,u("span",Se,f(e(S)),1)]),e(m)?x("",!0):(c(),j(K,{key:0,model:e(t),"label-width":"90px",ref_key:"formRef",ref:N,rules:e(T),class:"page-form mt-[30px]"},{default:r(()=>[s(z,null,{default:r(()=>[s(p,{span:24},{default:r(()=>[s(i,{label:e(n)("roleName"),prop:"role_name"},{default:r(()=>[s(o,{modelValue:e(t).role_name,"onUpdate:modelValue":a[1]||(a[1]=l=>e(t).role_name=l),placeholder:e(n)("roleNamePlaceholder"),clearable:"",disabled:e(t).uid,class:"input-width",maxlength:"10","show-word-limit":!0},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["label"])]),_:1}),s(p,{span:24},{default:r(()=>[s(i,{label:e(n)("status")},{default:r(()=>[s(M,{modelValue:e(t).status,"onUpdate:modelValue":a[2]||(a[2]=l=>e(t).status=l)},{default:r(()=>[s(g,{label:1},{default:r(()=>[E(f(e(n)("startUsing")),1)]),_:1}),s(g,{label:0},{default:r(()=>[E(f(e(n)("statusDeactivate")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model","rules"])),e(m)?x("",!0):(c(),y("div",Te,[s(H,{modelValue:e(k),"onUpdate:modelValue":a[4]||(a[4]=l=>U(k)?k.value=l:k=l),class:"demo-tabs"},{default:r(()=>[s(I,{label:e(n)("system"),name:"system"},{default:r(()=>[u("div",Ae,[u("div",null,[s(Q,{modelValue:e(_),"onUpdate:modelValue":a[3]||(a[3]=l=>U(_)?_.value=l:_=l),label:e(n)("selectAll")},null,8,["modelValue","label"])])]),s(G,{data:e(C),props:{label:"menu_name"},"show-checkbox":"",onCheckChange:e($),"expand-on-click-node":!1,"node-key":"menu_key",ref_key:"treeRef",ref:v},null,8,["data","onCheckChange"])]),_:1},8,["label"]),s(I,{label:e(n)("application"),name:"application"},{default:r(()=>[(c(!0),y(se,null,ne(e(A),(l,W)=>(c(),y("div",{key:W,class:"p-[15px] border-[1px] border-solid border-[#e4e7ed] mt-[15px]"},[l.children?(c(),j(ye,{key:0,modelValue:e(t).addon[l.key],"onUpdate:modelValue":X=>e(t).addon[l.key]=X,data:l},null,8,["modelValue","onUpdate:modelValue","data"])):x("",!0)]))),128))]),_:1},8,["label"])]),_:1},8,["modelValue"])])),e(m)?x("",!0):(c(),y("div",Fe,[u("div",$e,[s(L,{type:"primary",onClick:a[5]||(a[5]=l=>q(e(N)))},{default:r(()=>[E(f(e(n)("save")),1)]),_:1}),s(L,{onClick:a[6]||(a[6]=l=>e(w).push({path:"/setting/auth/role"}))},{default:r(()=>[E(f(e(n)("cancel")),1)]),_:1})])]))])),[[J,e(m)]])}}});const Ia=Le(qe,[["__scopeId","data-v-4840634a"]]);export{Ia as default};
